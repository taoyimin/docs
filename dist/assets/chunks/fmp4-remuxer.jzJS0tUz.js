import{a4 as Ve}from"./theme.VUuWSZc_.js";function $e(r,a){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);a&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),e.push.apply(e,t)}return e}function pe(r){for(var a=1;a<arguments.length;a++){var e=arguments[a]!=null?arguments[a]:{};a%2?$e(Object(e),!0).forEach(function(t){h(r,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):$e(Object(e)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(e,t))})}return r}function B(){B=function(){return r};var r={},a=Object.prototype,e=a.hasOwnProperty,t=Object.defineProperty||function(v,d,y){v[d]=y.value},n=typeof Symbol=="function"?Symbol:{},i=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function u(v,d,y){return Object.defineProperty(v,d,{value:y,enumerable:!0,configurable:!0,writable:!0}),v[d]}try{u({},"")}catch{u=function(d,y,A){return d[y]=A}}function l(v,d,y,A){var E=d&&d.prototype instanceof g?d:g,P=Object.create(E.prototype),U=new Q(A||[]);return t(P,"_invoke",{value:T(v,y,U)}),P}function c(v,d,y){try{return{type:"normal",arg:v.call(d,y)}}catch(A){return{type:"throw",arg:A}}}r.wrap=l;var f={};function g(){}function _(){}function m(){}var w={};u(w,i,function(){return this});var b=Object.getPrototypeOf,D=b&&b(b(k([])));D&&D!==a&&e.call(D,i)&&(w=D);var C=m.prototype=g.prototype=Object.create(w);function I(v){["next","throw","return"].forEach(function(d){u(v,d,function(y){return this._invoke(d,y)})})}function R(v,d){function y(E,P,U,x){var z=c(v[E],v,P);if(z.type!=="throw"){var N=z.arg,X=N.value;return X&&typeof X=="object"&&e.call(X,"__await")?d.resolve(X.__await).then(function(M){y("next",M,U,x)},function(M){y("throw",M,U,x)}):d.resolve(X).then(function(M){N.value=M,U(N)},function(M){return y("throw",M,U,x)})}x(z.arg)}var A;t(this,"_invoke",{value:function(E,P){function U(){return new d(function(x,z){y(E,P,x,z)})}return A=A?A.then(U,U):U()}})}function T(v,d,y){var A="suspendedStart";return function(E,P){if(A==="executing")throw new Error("Generator is already running");if(A==="completed"){if(E==="throw")throw P;return ne()}for(y.method=E,y.arg=P;;){var U=y.delegate;if(U){var x=H(U,y);if(x){if(x===f)continue;return x}}if(y.method==="next")y.sent=y._sent=y.arg;else if(y.method==="throw"){if(A==="suspendedStart")throw A="completed",y.arg;y.dispatchException(y.arg)}else y.method==="return"&&y.abrupt("return",y.arg);A="executing";var z=c(v,d,y);if(z.type==="normal"){if(A=y.done?"completed":"suspendedYield",z.arg===f)continue;return{value:z.arg,done:y.done}}z.type==="throw"&&(A="completed",y.method="throw",y.arg=z.arg)}}}function H(v,d){var y=d.method,A=v.iterator[y];if(A===void 0)return d.delegate=null,y==="throw"&&v.iterator.return&&(d.method="return",d.arg=void 0,H(v,d),d.method==="throw")||y!=="return"&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+y+"' method")),f;var E=c(A,v.iterator,d.arg);if(E.type==="throw")return d.method="throw",d.arg=E.arg,d.delegate=null,f;var P=E.arg;return P?P.done?(d[v.resultName]=P.value,d.next=v.nextLoc,d.method!=="return"&&(d.method="next",d.arg=void 0),d.delegate=null,f):P:(d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,f)}function F(v){var d={tryLoc:v[0]};1 in v&&(d.catchLoc=v[1]),2 in v&&(d.finallyLoc=v[2],d.afterLoc=v[3]),this.tryEntries.push(d)}function q(v){var d=v.completion||{};d.type="normal",delete d.arg,v.completion=d}function Q(v){this.tryEntries=[{tryLoc:"root"}],v.forEach(F,this),this.reset(!0)}function k(v){if(v){var d=v[i];if(d)return d.call(v);if(typeof v.next=="function")return v;if(!isNaN(v.length)){var y=-1,A=function E(){for(;++y<v.length;)if(e.call(v,y))return E.value=v[y],E.done=!1,E;return E.value=void 0,E.done=!0,E};return A.next=A}}return{next:ne}}function ne(){return{value:void 0,done:!0}}return _.prototype=m,t(C,"constructor",{value:m,configurable:!0}),t(m,"constructor",{value:_,configurable:!0}),_.displayName=u(m,o,"GeneratorFunction"),r.isGeneratorFunction=function(v){var d=typeof v=="function"&&v.constructor;return!!d&&(d===_||(d.displayName||d.name)==="GeneratorFunction")},r.mark=function(v){return Object.setPrototypeOf?Object.setPrototypeOf(v,m):(v.__proto__=m,u(v,o,"GeneratorFunction")),v.prototype=Object.create(C),v},r.awrap=function(v){return{__await:v}},I(R.prototype),u(R.prototype,s,function(){return this}),r.AsyncIterator=R,r.async=function(v,d,y,A,E){E===void 0&&(E=Promise);var P=new R(l(v,d,y,A),E);return r.isGeneratorFunction(d)?P:P.next().then(function(U){return U.done?U.value:P.next()})},I(C),u(C,o,"Generator"),u(C,i,function(){return this}),u(C,"toString",function(){return"[object Generator]"}),r.keys=function(v){var d=Object(v),y=[];for(var A in d)y.push(A);return y.reverse(),function E(){for(;y.length;){var P=y.pop();if(P in d)return E.value=P,E.done=!1,E}return E.done=!0,E}},r.values=k,Q.prototype={constructor:Q,reset:function(v){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(q),!v)for(var d in this)d.charAt(0)==="t"&&e.call(this,d)&&!isNaN(+d.slice(1))&&(this[d]=void 0)},stop:function(){this.done=!0;var v=this.tryEntries[0].completion;if(v.type==="throw")throw v.arg;return this.rval},dispatchException:function(v){if(this.done)throw v;var d=this;function y(z,N){return P.type="throw",P.arg=v,d.next=z,N&&(d.method="next",d.arg=void 0),!!N}for(var A=this.tryEntries.length-1;A>=0;--A){var E=this.tryEntries[A],P=E.completion;if(E.tryLoc==="root")return y("end");if(E.tryLoc<=this.prev){var U=e.call(E,"catchLoc"),x=e.call(E,"finallyLoc");if(U&&x){if(this.prev<E.catchLoc)return y(E.catchLoc,!0);if(this.prev<E.finallyLoc)return y(E.finallyLoc)}else if(U){if(this.prev<E.catchLoc)return y(E.catchLoc,!0)}else{if(!x)throw new Error("try statement without catch or finally");if(this.prev<E.finallyLoc)return y(E.finallyLoc)}}}},abrupt:function(v,d){for(var y=this.tryEntries.length-1;y>=0;--y){var A=this.tryEntries[y];if(A.tryLoc<=this.prev&&e.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var E=A;break}}E&&(v==="break"||v==="continue")&&E.tryLoc<=d&&d<=E.finallyLoc&&(E=null);var P=E?E.completion:{};return P.type=v,P.arg=d,E?(this.method="next",this.next=E.finallyLoc,f):this.complete(P)},complete:function(v,d){if(v.type==="throw")throw v.arg;return v.type==="break"||v.type==="continue"?this.next=v.arg:v.type==="return"?(this.rval=this.arg=v.arg,this.method="return",this.next="end"):v.type==="normal"&&d&&(this.next=d),f},finish:function(v){for(var d=this.tryEntries.length-1;d>=0;--d){var y=this.tryEntries[d];if(y.finallyLoc===v)return this.complete(y.completion,y.afterLoc),q(y),f}},catch:function(v){for(var d=this.tryEntries.length-1;d>=0;--d){var y=this.tryEntries[d];if(y.tryLoc===v){var A=y.completion;if(A.type==="throw"){var E=A.arg;q(y)}return E}}throw new Error("illegal catch attempt")},delegateYield:function(v,d,y){return this.delegate={iterator:k(v),resultName:d,nextLoc:y},this.method==="next"&&(this.arg=void 0),f}},r}function le(r){"@babel/helpers - typeof";return le=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},le(r)}function qe(r,a,e,t,n,i,s){try{var o=r[i](s),u=o.value}catch(l){e(l);return}o.done?a(u):Promise.resolve(u).then(t,n)}function re(r){return function(){var a=this,e=arguments;return new Promise(function(t,n){var i=r.apply(a,e);function s(u){qe(i,t,n,s,o,"next",u)}function o(u){qe(i,t,n,s,o,"throw",u)}s(void 0)})}}function K(r,a){if(!(r instanceof a))throw new TypeError("Cannot call a class as a function")}function We(r,a){for(var e=0;e<a.length;e++){var t=a[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,it(t.key),t)}}function Y(r,a,e){return a&&We(r.prototype,a),e&&We(r,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function h(r,a,e){return a=it(a),a in r?Object.defineProperty(r,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[a]=e,r}function ye(r,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(a&&a.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),a&&ge(r,a)}function ce(r){return ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ce(r)}function ge(r,a){return ge=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},ge(r,a)}function nt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Se(r,a,e){return nt()?Se=Reflect.construct.bind():Se=function(n,i,s){var o=[null];o.push.apply(o,i);var u=Function.bind.apply(n,o),l=new u;return s&&ge(l,s.prototype),l},Se.apply(null,arguments)}function pt(r){return Function.toString.call(r).indexOf("[native code]")!==-1}function we(r){var a=typeof Map=="function"?new Map:void 0;return we=function(t){if(t===null||!pt(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a<"u"){if(a.has(t))return a.get(t);a.set(t,n)}function n(){return Se(t,arguments,ce(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ge(n,t)},we(r)}function gt(r,a){if(r==null)return{};var e={},t=Object.keys(r),n,i;for(i=0;i<t.length;i++)n=t[i],!(a.indexOf(n)>=0)&&(e[n]=r[n]);return e}function _t(r,a){if(r==null)return{};var e=gt(r,a),t,n;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);for(n=0;n<i.length;n++)t=i[n],!(a.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(r,t)&&(e[t]=r[t])}return e}function S(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function yt(r,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return S(r)}function me(r){var a=nt();return function(){var t=ce(r),n;if(a){var i=ce(this).constructor;n=Reflect.construct(t,arguments,i)}else n=t.apply(this,arguments);return yt(this,n)}}function mt(r,a){for(;!Object.prototype.hasOwnProperty.call(r,a)&&(r=ce(r),r!==null););return r}function Te(){return typeof Reflect<"u"&&Reflect.get?Te=Reflect.get.bind():Te=function(a,e,t){var n=mt(a,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?a:t):i.value}},Te.apply(this,arguments)}function bt(r,a){if(r){if(typeof r=="string")return Ke(r,a);var e=Object.prototype.toString.call(r).slice(8,-1);if(e==="Object"&&r.constructor&&(e=r.constructor.name),e==="Map"||e==="Set")return Array.from(r);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Ke(r,a)}}function Ke(r,a){(a==null||a>r.length)&&(a=r.length);for(var e=0,t=new Array(a);e<a;e++)t[e]=r[e];return t}function Et(r,a){var e=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=bt(r))||a){e&&(r=e);var t=0,n=function(){};return{s:n,n:function(){return t>=r.length?{done:!0}:{done:!1,value:r[t++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){e=e.call(r)},n:function(){var u=e.next();return i=u.done,u},e:function(u){s=!0,o=u},f:function(){try{!i&&e.return!=null&&e.return()}finally{if(s)throw o}}}}function St(r,a){if(typeof r!="object"||r===null)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var t=e.call(r,a||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(r)}function it(r){var a=St(r,"string");return typeof a=="symbol"?a:String(a)}var oe=function(){function r(){K(this,r)}return Y(r,null,[{key:"start",value:function(e){return!e||!e.length||e.length===1&&e.end(0)-e.start(0)<1e-6||e.length===1&&e.start(0)<0?0:e.start(0)}},{key:"end",value:function(e){return!e||!e.length||e.length===1&&e.end(0)-e.start(0)<1e-6?0:e.end(e.length-1)}},{key:"get",value:function(e){if(e)try{return e.buffered}catch{}}},{key:"buffers",value:function(e,t){if(!e||!e.length)return[];for(var n=[],i=0,s=e.length;i<s;i++){var o=n.length;if(!o||!t)n.push([e.start(i),e.end(i)]);else{var u=n[o-1],l=u[1],c=e.start(i);if(c-l<=t){var f=e.end(i);f>l&&(u[1]=f)}else n.push([e.start(i),e.end(i)])}}return n}},{key:"totalLength",value:function(e){return!e||!e.length?0:e.reduce(function(t,n){return t+=n[1]-n[0]},0)}},{key:"info",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(!e||!e.length)return{start:0,end:0,buffers:[]};for(var i=0,s=0,o=0,u=0,l=0,c=0,f=0,g=r.buffers(e,n),_=0,m=g.length;_<m;_++){var w=g[_];if(t+n>=w[0]&&t<=w[1])i=w[0],s=w[1],o=_;else if(t+n<w[0]){u=w[0],l=w[1];break}else t+n>w[1]&&(c=w[0],f=w[1])}return{start:i,end:s,index:o,buffers:g,nextStart:u,nextEnd:l,prevStart:c,prevEnd:f,currentTime:t,behind:t-i,remaining:s?s-t:0,length:r.totalLength&&r.totalLength(g)}}},{key:"isBuffered",value:function(e,t){if(e){var n=r.get(e);if(n!=null&&n.length){for(var i=0;i<n.length;i++)if(t>=n.start(i)&&t<=n.end(i))return!0}}return!1}}]),r}(),Tt=typeof window<"u",W,L={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",NETWORK_FORBIDDEN:"network_forbidden",NETWORK_NOTFOUND:"network_notfound",NETWROK_RANGE_NOT_SATISFIABLE:"network_range_not_satisfiable",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",RUNTIME:"runtime",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",MSE_CHANGE_TYPE:"MSE_CHANGE_TYPE",OPTION:"OPTION",DASH:"DASH",LICENSE:"LICENSE",CUSTOM_LICENSE:"CUSTOM_LICENSE",MSE_HIJACK:"MSE_HIJACK",EME_HIJACK:"EME_HIJACK",SIDX:"SIDX",NO_CANPLAY_ERROR:"NO_CANPLAY_ERROR",BUFFERBREAK_ERROR:"BUFFERBREAK_ERROR",WAITING_TIMEOUT_ERROR:"WAITING_TIMEOUT_ERROR",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_CODEC_NOT_SUPPORTED:"MEDIA_ERR_CODEC_NOT_SUPPORTED",MEDIA_ERR_URL_EMPTY:"MEDIA_ERR_URL_EMPTY"}},Le=(W={},h(W,L.MANIFEST,{HLS:1100,DASH:1200}),h(W,L.NETWORK,2100),h(W,L.NETWORK_TIMEOUT,2101),h(W,L.NETWORK_FORBIDDEN,2103),h(W,L.NETWORK_NOTFOUND,2104),h(W,L.NETWROK_RANGE_NOT_SATISFIABLE,2116),h(W,L.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),h(W,L.REMUX,{FMP4:4100,MP4:4200}),h(W,L.MEDIA,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,MSE_CHANGE_TYPE:5205,EME_HIJACK:5301}),h(W,L.DRM,{LICENSE:7100,CUSTOM_LICENSE:7200}),h(W,L.OTHER,8e3),h(W,L.RUNTIME,{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002,WAITING_TIMEOUT_ERROR:9003}),W),ae=function(r){ye(e,r);var a=me(e);function e(t,n,i,s,o){var u;return K(this,e),u=a.call(this,o||(i==null?void 0:i.message)),u.errorType=t===L.NETWORK_TIMEOUT?L.NETWORK:t,u.originError=i,u.ext=s,u.errorCode=Le[t][n]||Le[t],u.errorMessage=u.message,u.errorCode||(u.errorType=L.OTHER,u.errorCode=Le[u.errorType]),u}return Y(e,null,[{key:"create",value:function(n,i,s,o,u){return n instanceof e?n:(n instanceof Error&&(s=n,n=""),n||(n=L.OTHER),new e(n,i,s,o,u))}},{key:"network",value:function(n){var i;return new e(n!=null&&n.isTimeout?L.NETWORK_TIMEOUT:L.NETWORK,null,n instanceof Error?n:null,{url:n==null?void 0:n.url,response:n==null?void 0:n.response,httpCode:n==null||(i=n.response)===null||i===void 0?void 0:i.status})}}]),e}(we(Error)),be={DEBUG:1,LOG:2,WARN:3,ERROR:4},wt=200*1024,At=["Boolean","Number","String","Undefined","Null","Date","Object"],Ae=function(){function r(a,e){K(this,r),this.name=a||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(e==null?void 0:e.logCacheLevel)||3,this.logMaxSize=(e==null?void 0:e.logMaxSize)||wt,this.logSize=0,this.logTextArray=[]}return Y(r,[{key:"debug",value:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logCache.apply(this,[be.DEBUG].concat(n)),!r.disabled&&(e=console).debug.apply(e,["[".concat(ve(),"]"),this._prefix].concat(n))}},{key:"log",value:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logCache.apply(this,[be.LOG].concat(n)),!r.disabled&&(e=console).log.apply(e,["[".concat(ve(),"]"),this._prefix].concat(n))}},{key:"warn",value:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logCache.apply(this,[be.WARN].concat(n)),!r.disabled&&(e=console).warn.apply(e,["[".concat(ve(),"]"),this._prefix].concat(n))}},{key:"error",value:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logCache.apply(this,[be.ERROR].concat(n)),!r.disabled&&(e=console).error.apply(e,["[".concat(ve(),"]"),this._prefix].concat(n))}},{key:"logCache",value:function(e){if(!(e<this.logCacheLevel)){var t="";try{for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];var o=i.map(function(l){return at(l)});t="[".concat(ve(),"]")+this._prefix+JSON.stringify(o)}catch{return}if(e>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize){var u=this.logTextArray.shift();this.logSize-=u.length}}}},{key:"getLogCache",value:function(){var e=this.logTextArray.join(`
`);return this.reset(),e}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var e;r.disabled||(console.group(this._prefix),(e=console).table.apply(e,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(e){this.logCacheLevel=e}}],[{key:"enable",value:function(){r.disabled=!1}},{key:"disable",value:function(){r.disabled=!0}}]),r}();h(Ae,"disabled",!0);function ve(){return new Date().toLocaleString()}function Ot(r){if(le(r)!=="object")return r;var a=Object.prototype.toString.call(r).slice(8,-1);switch(a){case"Array":case"Uint8Array":case"ArrayBuffer":return a+"["+r.length+"]";case"Object":return"{}";default:return a}}function at(r,a,e){e||(e=1),a||(a=2);var t={};if(!r||le(r)!=="object")return r;var n=Object.prototype.toString.call(r).slice(8,-1);if(!At.includes(n))return n;if(!(e>a)){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e===a?t[i]=Ot(r[i]):le(r[i])==="object"?t[i]=at(r[i],a,e+1):t[i]=r[i]);return t}}function he(){var r,a,e=new Promise(function(t,n){r=t,a=n});return e.used=!1,e.resolve=function(){return e.used=!0,r.apply(void 0,arguments)},e.reject=function(){return e.used=!0,a.apply(void 0,arguments)},e}function fe(){try{return parseInt(performance.now(),10)}catch{return new Date().getTime()}}var Rt={stringify:function(a){try{return JSON.stringify(a)}catch{return""}},parse:function(a){try{return JSON.parse(a)}catch{return}}};function Ye(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;try{return Tt?r&&typeof ManagedMediaSource<"u"?ManagedMediaSource:window.MediaSource:null}catch{}}function ke(r){return/ManagedMediaSource/gi.test(Object.prototype.toString.call(r))}function Pt(r){var a=[];if(r instanceof TimeRanges)for(var e=0;e<r.length;e++)a.push({start:r.start(e),end:r.end(e)});return a}var Ee={APPEND:"appendBuffer",REMOVE:"removeBuffer",UPDATE_DURATION:"updateDuration"},st=function(){function r(a,e){var t=this;K(this,r),h(this,"media",null),h(this,"mediaSource",null),h(this,"_openPromise",he()),h(this,"_queue",Object.create(null)),h(this,"_sourceBuffer",Object.create(null)),h(this,"_mseFullFlag",{}),h(this,"_st",0),h(this,"_opst",0),h(this,"_logger",null),h(this,"_config",null),h(this,"_url",null),h(this,"_onStartStreaming",function(){t._logger.debug("startstreaming")}),h(this,"_onEndStreaming",function(){t._logger.debug("endstreaming")}),h(this,"_onSBUpdateEnd",function(n){var i=t._queue[n];if(i){var s=i[0];if((s==null?void 0:s.opName)!==Ee.UPDATE_DURATION&&i.shift(),s){var o,u,l=fe()-t._opst;t._logger.debug("UpdateEnd(".concat(n,"/").concat(s.opName,")"),Rt.stringify(Pt((o=t._sourceBuffer[n])===null||o===void 0?void 0:o.buffered)),l,s.context),s.promise.resolve({name:s.opName,context:s.context,costtime:l});var c=(u=s.context)===null||u===void 0?void 0:u.callback;c&&typeof c=="function"&&c(s.context),t._startQueue(n)}}}),h(this,"_onSBUpdateError",function(n,i){var s=t._queue[n];if(s){var o=s[0];o&&(t._logger.error("UpdateError",n,o.opName,o.context),o.promise.reject(new ae(L.MEDIA,L.SUB_TYPES.MSE_APPEND_BUFFER,i)))}}),this._config=Object.assign(r.getDefaultConfig(),e),a&&this.bindMedia(a),this._logger=new Ae("MSE"),this._config.openLog&&Ae.enable()}return Y(r,[{key:"isOpened",get:function(){var e;return((e=this.mediaSource)===null||e===void 0?void 0:e.readyState)==="open"}},{key:"hasOpTasks",get:function(){var e=this,t=!1;return Object.keys(this._queue).forEach(function(n){var i=e._queue[n];Array.isArray(i)&&(t||(t=i.length>0))}),t}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var e;return((e=this.mediaSource)===null||e===void 0?void 0:e.duration)||-1}},{key:"isEnded",get:function(){return this.mediaSource?this.mediaSource.readyState==="ended":!1}},{key:"streaming",get:function(){return ke(this.mediaSource)?this.mediaSource.streaming:!0}},{key:"isFull",value:function(e){return e?this._mseFullFlag[e]:this._mseFullFlag[r.VIDEO]}},{key:"updateDuration",value:function(e){var t=this,n=this.mediaSource&&this.mediaSource.duration>e;if(this.mediaSource&&this.mediaSource.duration>e){var i=0;if(Object.keys(this._sourceBuffer).forEach(function(s){try{i=Math.max(t.bufferEnd(s)||0,i)}catch{}}),e<i)return Promise.resolve()}return this._enqueueBlockingOp(function(){if(t.isEnded){t._logger.debug("setDuration but ended");return}t.mediaSource&&(t.mediaSource.duration=e,t._logger.debug("setDuration",e))},Ee.UPDATE_DURATION,{isReduceDuration:n})}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource,n=function i(){var s=fe()-e._st;e._logger.debug("sourceopen",s),t.removeEventListener("sourceopen",i),e._openPromise.resolve({costtime:s})};t.addEventListener("sourceopen",n),this._openPromise=he()}return this._openPromise}},{key:"bindMedia",value:function(){var a=re(B().mark(function t(n){var i=this,s,o,u,l;return B().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(this.mediaSource||this.media)){f.next=3;break}return f.next=3,this.unbindMedia();case 3:if(s=Ye(this._config.preferMMS),!(!n||!s)){f.next=6;break}throw new Error("Param media or MediaSource does not exist");case 6:return this.media=n,o=this.mediaSource=new s,u=ke(o),this._st=fe(),l=function g(){var _=fe()-i._st;i._logger.debug("sourceopen"),o.removeEventListener("sourceopen",g),URL.revokeObjectURL(n.src),i._openPromise.resolve({costtime:_})},o.addEventListener("sourceopen",l),u&&(o.addEventListener("startstreaming",this._onStartStreaming),o.addEventListener("endstreaming",this._onEndStreaming)),this._url=URL.createObjectURL(o),n.src=this._url,n.disableRemotePlayback=u,f.abrupt("return",this._openPromise);case 17:case"end":return f.stop()}},t,this)}));function e(t){return a.apply(this,arguments)}return e}()},{key:"unbindMedia",value:function(){var a=re(B().mark(function t(){var n=this,i,s,o;return B().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),i=this.mediaSource,i){if(Object.keys(this._queue).forEach(function(c){var f=n._queue[c];f&&f.forEach(function(g){var _,m;return(_=g.promise)===null||_===void 0||(m=_.resolve)===null||m===void 0?void 0:m.call(_)})}),s=!!this.media&&this.media.readyState>=1,o=i.readyState==="open",s&&o)try{i.endOfStream()}catch{}Object.keys(this._sourceBuffer).forEach(function(c){try{i.removeSourceBuffer(n._sourceBuffer[c])}catch{}}),ke(i)&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming))}if(this.media){this.media.disableRemotePlayback=!1,this.media.removeAttribute("src");try{this.media.load()}catch{}this.media=null}this.mediaSource=null,this._openPromise=he(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return l.stop()}},t,this)}));function e(){return a.apply(this,arguments)}return e}()},{key:"createSource",value:function(e,t){if(!(this._sourceBuffer[e]||!this.mediaSource)){var n;try{n=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(i){throw new ae(L.MEDIA,L.SUB_TYPES.MSE_ADD_SB,i)}n.mimeType=t,n.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),n.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var n=this,i=this._sourceBuffer[e];return!this.mediaSource||!i||i.mimeType===t?Promise.resolve():typeof i.changeType!="function"?Promise.reject(new ae(L.MEDIA,L.SUB_TYPES.MSE_CHANGE_TYPE,new Error("changeType is not a function"))):this._enqueueOp(e,function(){try{i.changeType(t)}catch(s){throw new ae(L.MEDIA,L.SUB_TYPES.MSE_CHANGE_TYPE,s)}i.mimeType=t,n._onSBUpdateEnd(e)},"changeType",{mimeType:t})}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t,n){var i=this;return!t||!t.byteLength||!this._sourceBuffer[e]?Promise.resolve():this._enqueueOp(e,function(){var s;!i.mediaSource||i.media.error||(i._logger.debug("MSE APPEND START",n),i._opst=fe(),(s=i._sourceBuffer[e])===null||s===void 0||s.appendBuffer(t))},Ee.APPEND,n)}},{key:"remove",value:function(e,t,n,i){var s=this,o=!1;return this._mseFullFlag[e]&&(o=!0),this._enqueueOp(e,function(){if(!(!s.mediaSource||s.media.error)){var u=s._sourceBuffer[e];if(t>=n||!u){s._onSBUpdateEnd(e);return}s._opst=fe(),s._logger.debug("MSE REMOVE START",e,t,n,i),u.remove(t,n)}},Ee.REMOVE,i,o)}},{key:"clearBuffer",value:function(e,t){var n=this,i;return Object.keys(this._sourceBuffer).forEach(function(s){i=n.remove(s,e,t)}),i||Promise.resolve()}},{key:"clearAllBuffer",value:function(){var e=this,t;return Object.keys(this._sourceBuffer).forEach(function(n){var i=e._sourceBuffer[n];t=e.remove(n,0,oe.end(oe.get(i)))}),t}},{key:"clearOpQueues",value:function(e,t){var n;this._logger.debug("MSE clearOpQueue START");var i=this._queue[e];if(t&&i){this._queue[e]=[];return}if(!(!i||!i[e]||i.length<5)){var s=[];i.forEach(function(o){o.context&&o.context.isinit&&s.push(o)}),this._queue[e]=i.slice(0,2),s.length>0&&(n=this._queue[e]).push.apply(n,s)}}},{key:"endOfStream",value:function(e){var t=this;return!this.mediaSource||this.mediaSource.readyState!=="open"?Promise.resolve():this._enqueueBlockingOp(function(){var n=t.mediaSource;!n||n.readyState!=="open"||(t._logger.debug("MSE endOfStream START"),e?n.endOfStream(e):n.endOfStream())},"endOfStream")}},{key:"setLiveSeekableRange",value:function(e,t){var n=this.mediaSource;e<0||t<e||!(n!=null&&n.setLiveSeekableRange)||n.readyState!=="open"||n.setLiveSeekableRange(e,t)}},{key:"getSourceBuffer",value:function(e){return this._sourceBuffer[e]}},{key:"buffered",value:function(e){return oe.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return oe.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return oe.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t,n,i,s){var o=this;if(!this.mediaSource)return Promise.resolve();var u=this._queue[e]=this._queue[e]||[],l={exec:t,promise:he(),opName:n,context:i};return s?(u.splice(0,0,l),this._mseFullFlag[e]=!1,this._startQueue(e)):u.push(l),this.isOpened||this.isEnded?u.length===1&&this._startQueue(e):this._openPromise.then(function(){u.length===1&&o._startQueue(e)}),l.promise}},{key:"_enqueueBlockingOp",value:function(){var a=re(B().mark(function t(n,i,s){var o=this,u,l;return B().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.mediaSource){f.next=2;break}return f.abrupt("return",Promise.resolve());case 2:if(u=Object.keys(this._sourceBuffer),u.length){f.next=5;break}return f.abrupt("return",n());case 5:return l=[],u.forEach(function(g){var _=o._queue[g],m=he();l.push(m),_.push({exec:function(){m.resolve()},promise:m,opName:i,context:s}),_.length===1&&o._startQueue(g)}),f.abrupt("return",Promise.all(l).then(function(){try{return n()}finally{u.forEach(function(g){var _=o._queue[g],m=o._sourceBuffer[g];_==null||_.shift(),(!m||!m.updating)&&o._startQueue(g)})}}));case 8:case"end":return f.stop()}},t,this)}));function e(t,n,i){return a.apply(this,arguments)}return e}()},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var n=t[0];if(n&&!this._mseFullFlag[e])try{n.exec()}catch(o){if(o&&o.message&&o.message.indexOf("SourceBuffer is full")>=0){var i;this._mseFullFlag[e]=!0,n.context&&le(n.context)==="object"&&(n.context.isFull=!0),this._logger.error("[MSE error],  context,",n.context," ,name,",n.opName,",err,SourceBuffer is full"),n==null||(i=n.promise)===null||i===void 0||i.reject(new ae(L.MEDIA,L.SUB_TYPES.MSE_FULL,o))}else{var s;this._logger.error(o),n==null||(s=n.promise)===null||s===void 0||s.reject(o.constructor===ae?o:new ae(L.MEDIA,L.SUB_TYPES.MSE_OTHER,o)),t.shift(),this._startQueue(e)}}}}},{key:"setTimeoffset",value:function(e,t,n){var i=this;return this._enqueueOp(e,function(){t<0&&(t+=.001),i._sourceBuffer[e].timestampOffset=t,i._onSBUpdateEnd(e)},"setTimeoffset",n)}},{key:"abort",value:function(e,t){var n=this;return this.isOpened?this._enqueueOp(e,function(){n._sourceBuffer[e].abort(),n._onSBUpdateEnd(e)},"abort",t):Promise.resolve()}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"',t=Ye();if(!t)return!1;try{return t.isTypeSupported(e)}catch(n){return this._logger.error(e,n),!1}}},{key:"isMMSOnly",value:function(){return typeof ManagedMediaSource<"u"&&typeof MediaSource>"u"}},{key:"getDefaultConfig",value:function(){return{openLog:!1,preferMMS:!1}}}]),r}();h(st,"VIDEO","video");h(st,"AUDIO","audio");var ue={FETCH:"fetch",XHR:"xhr"},_e={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},ee=function(r){ye(e,r);var a=me(e);function e(t,n,i,s){var o;return K(this,e),o=a.call(this,s),h(S(o),"retryCount",0),h(S(o),"isTimeout",!1),h(S(o),"loaderType",ue.FETCH),h(S(o),"startTime",0),h(S(o),"endTime",0),h(S(o),"options",{}),o.url=t,o.request=n,o.response=i,o}return Y(e)}(we(Error)),ot=Object.prototype.toString;function Dt(r){return r!==null&&le(r)==="object"}function Xe(r){if(ot.call(r)!=="[object Object]")return!1;var a=Object.getPrototypeOf(r);return a===null||a===Object.prototype}function Lt(r){return ot.call(r)==="[object Date]"}function ut(r){if(!(!r||r[0]===null||r[0]===void 0||r[0]===0&&(r[1]===null||r[1]===void 0))){var a="bytes="+r[0]+"-";return r[1]&&(a+=r[1]),a}}function Qe(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function lt(r,a){if(r){if(!a)return r;var e,t=Object.keys(a).map(function(i){if(e=a[i],e!=null)return Array.isArray(e)?i=i+"[]":e=[e],e.map(function(s){return Lt(s)?s=s.toISOString():Dt(s)&&(s=JSON.stringify(s)),"".concat(Qe(i),"=").concat(Qe(s))}).join("&")}).filter(Boolean).join("&");if(t){var n=r.indexOf("#");n!==-1&&(r=r.slice(0,n)),r+=(r.indexOf("?")===-1?"?":"&")+t}return r}}function Ce(r,a,e,t,n,i,s,o,u,l,c){n=n!=null?parseFloat(n):null,t=parseInt(t||"0",10),Number.isNaN(t)&&(t=0);var f={range:u,vid:l,index:o,contentLength:t,age:n,startTime:i,firstByteTime:s,endTime:Date.now(),priOptions:c};return{data:r,done:a,options:f,response:e}}function Ue(r,a){return Math.round(r*8*1e3/a/1024)}var J={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",MEDIASOURCE_OPENED:"core.mediasourceopened",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",APPEND_BUFFER:"core.appendbuffer",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",CHASEFRAME:"core.chaseframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",DEMUXED_TRACK:"core.demuxedtrack",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},Je=2*1024*1024,Me=function(r){ye(e,r);var a=me(e);function e(){var t;return K(this,e),t=a.call(this),h(S(t),"_abortController",null),h(S(t),"_timeoutTimer",null),h(S(t),"_reader",null),h(S(t),"_response",null),h(S(t),"_aborted",!1),h(S(t),"_index",-1),h(S(t),"_range",null),h(S(t),"_receivedLength",0),h(S(t),"_running",!1),h(S(t),"_logger",null),h(S(t),"_vid",""),h(S(t),"_onProcessMinLen",0),h(S(t),"_onCancel",null),h(S(t),"_priOptions",null),t}return Y(e,[{key:"load",value:function(n){var i,s=this,o=n.url,u=n.vid,l=n.timeout,c=n.responseType,f=n.onProgress,g=n.index,_=n.onTimeout,m=n.onCancel,w=n.range,b=n.transformResponse,D=n.request,C=n.params,I=n.logger,R=n.method,T=n.headers,H=n.body,F=n.mode,q=n.credentials,Q=n.cache,k=n.redirect,ne=n.referrer,v=n.referrerPolicy,d=n.onProcessMinLen,y=n.priOptions;this._logger=I,this._aborted=!1,this._onProcessMinLen=d,this._onCancel=m,this._abortController=typeof AbortController<"u"&&new AbortController,this._running=!0,this._index=g,this._range=w||[0,0],this._vid=u||o,this._priOptions=y||{};var A={method:R,headers:T,body:H,mode:F,credentials:q,cache:Q,redirect:k,referrer:ne,referrerPolicy:v,signal:(i=this._abortController)===null||i===void 0?void 0:i.signal},E=!1;clearTimeout(this._timeoutTimer),o=lt(o,C);var P=ut(w);P&&(D?T=D.headers:T=A.headers=A.headers||(Headers?new Headers:{}),Headers&&T instanceof Headers?T.append("Range",P):T.Range=P),l&&(this._timeoutTimer=setTimeout(function(){if(E=!0,s.cancel(),_){var x=new ee(o,A,null,"timeout");x.isTimeout=!0,_(x,{index:s._index,range:s._range,vid:s._vid,priOptions:s._priOptions})}},l));var U=Date.now();return this._logger.debug("[fetch load start], index,",g,",range,",w),new Promise(function(x,z){fetch(D||o,D?void 0:A).then(function(){var N=re(B().mark(function X(M){var Pe,ie,De,ze;return B().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(clearTimeout(s._timeoutTimer),s._response=M,!(s._aborted||!s._running)){G.next=4;break}return G.abrupt("return");case 4:if(b&&(M=b(M,o)||M),M.ok){G.next=7;break}throw new ee(o,A,M,"bad network response");case 7:if(Pe=Date.now(),c!==_e.TEXT){G.next=15;break}return G.next=11,M.text();case 11:ie=G.sent,s._running=!1,G.next=37;break;case 15:if(c!==_e.JSON){G.next=22;break}return G.next=18,M.json();case 18:ie=G.sent,s._running=!1,G.next=37;break;case 22:if(!f){G.next=29;break}return s.resolve=x,s.reject=z,s._loadChunk(M,f,U,Pe),G.abrupt("return");case 29:return G.next=31,M.arrayBuffer();case 31:ie=G.sent,ie=new Uint8Array(ie),s._running=!1,De=Date.now()-U,ze=Ue(ie.byteLength,De),s.emit(J.REAL_TIME_SPEED,{speed:ze,len:ie.byteLength,time:De,vid:s._vid,index:s._index,range:s._range,priOptions:s._priOptions});case 37:s._logger.debug("[fetch load end], index,",g,",range,",w),x(Ce(ie,!0,M,M.headers.get("Content-Length"),M.headers.get("age"),U,Pe,g,w,s._vid,s._priOptions));case 39:case"end":return G.stop()}},X)}));return function(X){return N.apply(this,arguments)}}()).catch(function(N){var X;clearTimeout(s._timeoutTimer),s._running=!1,!(s._aborted&&!E)&&(N=N instanceof ee?N:new ee(o,A,null,(X=N)===null||X===void 0?void 0:X.message),N.startTime=U,N.endTime=Date.now(),N.isTimeout=E,N.options={index:s._index,range:s._range,vid:s._vid,priOptions:s._priOptions},z(N))})})}},{key:"cancel",value:function(){var t=re(B().mark(function i(){return B().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this._aborted){o.next=2;break}return o.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){o.next=14;break}if(o.prev=5,!this._reader){o.next=9;break}return o.next=9,this._reader.cancel();case 9:o.next=13;break;case 11:o.prev=11,o.t0=o.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch{}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return o.stop()}},i,this,[[5,11]])}));function n(){return t.apply(this,arguments)}return n}()},{key:"_loadChunk",value:function(n,i,s,o){var u=this;if(!n.body||!n.body.getReader){this._running=!1;var l=new ee(n.url,"",n,"onProgress of bad response.body.getReader");l.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(l);return}this._onProcessMinLen>0&&(this._cache=new Uint8Array(Je),this._writeIdx=0);var c=this._reader=n.body.getReader(),f,g,_,m=function(){var w=re(B().mark(function b(){var D,C,I,R,T,H,F,q;return B().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return g=Date.now(),k.prev=1,k.next=4,c.read();case 4:f=k.sent,_=Date.now(),k.next=13;break;case 8:return k.prev=8,k.t0=k.catch(1),_=Date.now(),u._aborted||(u._running=!1,k.t0.options={index:u._index,range:u._range,vid:u._vid,priOptions:u._priOptions},u.reject(k.t0)),k.abrupt("return");case 13:if(C=((D=u._range)===null||D===void 0?void 0:D.length)>0?u._range[0]:0,I=C+u._receivedLength,!u._aborted){k.next=19;break}return u._running=!1,i(void 0,!1,{range:[I,I],vid:u._vid,index:u._index,startTime:g,endTime:_,st:s,firstByteTime:o,priOptions:u._priOptions},n),k.abrupt("return");case 19:R=f.value?f.value.byteLength:0,u._receivedLength+=R,u._logger.debug("【fetchLoader,onProgress call】,task,",u._range,", start,",I,", end,",C+u._receivedLength,", done,",f.done),u._onProcessMinLen>0?u._writeIdx+R>=u._onProcessMinLen||f.done?(T=new Uint8Array(u._writeIdx+R),T.set(u._cache.slice(0,u._writeIdx),0),R>0&&T.set(f.value,u._writeIdx),u._writeIdx=0,u._logger.debug("【fetchLoader,onProgress enough】,done,",f.done,",len,",T.byteLength,", writeIdx,",u._writeIdx)):R>0&&u._writeIdx+R<Je?(u._cache.set(f.value,u._writeIdx),u._writeIdx+=R,u._logger.debug("【fetchLoader,onProgress cache】,len,",R,", writeIdx,",u._writeIdx)):R>0&&(H=new Uint8Array(u._writeIdx+R+2048),u._logger.debug("【fetchLoader,onProgress extra start】,size,",u._writeIdx+R+2048,", datalen,",R,", writeIdx,",u._writeIdx),H.set(u._cache.slice(0,u._writeIdx),0),R>0&&H.set(f.value,u._writeIdx),u._writeIdx+=R,delete u._cache,u._cache=H,u._logger.debug("【fetchLoader,onProgress extra end】,len,",R,", writeIdx,",u._writeIdx)):T=f.value,(T&&T.byteLength>0||f.done)&&i(T,f.done,{range:[u._range[0]+u._receivedLength-(T?T.byteLength:0),u._range[0]+u._receivedLength],vid:u._vid,index:u._index,startTime:g,endTime:_,st:s,firstByteTime:o,priOptions:u._priOptions},n),f.done?(F=Date.now()-s,q=Ue(u._receivedLength,F),u.emit(J.REAL_TIME_SPEED,{speed:q,len:u._receivedLength,time:F,vid:u._vid,index:u._index,range:u._range,priOptions:u._priOptions}),u._running=!1,u._logger.debug("[fetchLoader onProgress end],task,",u._range,",done,",f.done),u.resolve(Ce(f,!0,n,n.headers.get("Content-Length"),n.headers.get("age"),s,o,u._index,u._range,u._vid,u._priOptions))):m();case 25:case"end":return k.stop()}},b,null,[[1,8]])}));return function(){return w.apply(this,arguments)}}();m()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(n){this._running=n}}],[{key:"isSupported",value:function(){return typeof fetch<"u"}}]),e}(Ve);function kt(r){return pe({loaderType:ue.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:_e.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},r)}var Ct=function(r){ye(e,r);var a=me(e);function e(){var t;return K(this,e),t=a.call(this),h(S(t),"_xhr",null),h(S(t),"_aborted",!1),h(S(t),"_timeoutTimer",null),h(S(t),"_range",null),h(S(t),"_receivedLength",0),h(S(t),"_url",null),h(S(t),"_onProgress",null),h(S(t),"_index",-1),h(S(t),"_headers",null),h(S(t),"_currentChunkSizeKB",384),h(S(t),"_timeout",null),h(S(t),"_xhr",null),h(S(t),"_withCredentials",null),h(S(t),"_startTime",-1),h(S(t),"_loadCompleteResolve",null),h(S(t),"_loadCompleteReject",null),h(S(t),"_runing",!1),h(S(t),"_logger",!1),h(S(t),"_vid",""),h(S(t),"_responseType",void 0),h(S(t),"_credentials",void 0),h(S(t),"_method",void 0),h(S(t),"_transformResponse",void 0),h(S(t),"_firstRtt",void 0),h(S(t),"_onCancel",null),h(S(t),"_priOptions",null),t}return Y(e,[{key:"load",value:function(n){var i=this;clearTimeout(this._timeoutTimer),this._logger=n.logger,this._range=n.range,this._onProgress=n.onProgress,this._index=n.index,this._headers=n.headers,this._withCredentials=n.credentials==="include"||n.credentials==="same-origin",this._body=n.body||null,n.method&&(this._method=n.method),this._timeout=n.timeout||null,this._runing=!0,this._vid=n.vid||n.url,this._responseType=n.responseType,this._firstRtt=-1,this._onTimeout=n.onTimeout,this._onCancel=n.onCancel,this._request=n.request,this._priOptions=n.priOptions||{},this._logger.debug("【xhrLoader task】, range",this._range),this._url=lt(n.url,n.params);var s=Date.now();return new Promise(function(o,u){i._loadCompleteResolve=o,i._loadCompleteReject=u,i._startLoad()}).catch(function(o){if(clearTimeout(i._timeoutTimer),i._runing=!1,!i._aborted)throw o=o instanceof ee?o:new ee(i._url,i._request),o.startTime=s,o.endTime=Date.now(),o.options={index:i._index,vid:i._vid,priOptions:i._priOptions},o})}},{key:"_startLoad",value:function(){var n=null;if(this._responseType===_e.ARRAY_BUFFER&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var i=this._currentChunkSizeKB*1024,s=this._range[0]+this._receivedLength,o=this._range[1];i<this._range[1]-s&&(o=s+i),n=[s,o],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",n)}else n=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",n);this._internalOpen(n)}},{key:"_internalOpen",value:function(n){var i=this;try{this._startTime=Date.now();var s=this._xhr=new XMLHttpRequest;s.open(this._method||"GET",this._url,!0),s.responseType=this._responseType,this._timeout&&(s.timeout=this._timeout),s.withCredentials=this._withCredentials,s.onload=this._onLoad.bind(this),s.onreadystatechange=this._onReadyStatechange.bind(this),s.onerror=function(l){var c,f,g;i._running=!1;var _=new ee(i._url,i._request,l==null||(c=l.currentTarget)===null||c===void 0?void 0:c.response,"xhr.onerror.status:"+(l==null||(f=l.currentTarget)===null||f===void 0?void 0:f.status)+",statusText,"+(l==null||(g=l.currentTarget)===null||g===void 0?void 0:g.statusText));_.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i._loadCompleteReject(_)},s.ontimeout=function(l){i.cancel();var c=new ee(i._url,i._request,{status:408},"timeout");i._onTimeout&&(c.isTimeout=!0,i._onTimeout(c,{index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions})),c.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i._loadCompleteReject(c)};var o=this._headers||{},u=ut(n);u&&(o.Range=u),o&&Object.keys(o).forEach(function(l){s.setRequestHeader(l,o[l])}),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",n),s.send(this._body)}catch(l){l.options={index:this._index,range:n,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(l)}}},{key:"_onReadyStatechange",value:function(n){var i=n.target;i.readyState===2&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(n){var i,s=n.target.status;if(s<200||s>299){var o=new ee(this._url,null,pe(pe({},n.target.response),{},{status:s}),"bad response,status:"+s);return o.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(o)}var u=null,l=!1,c,f=((i=this._range)===null||i===void 0?void 0:i.length)>0?this._range[0]:0;if(this._responseType===_e.ARRAY_BUFFER){var g,_=new Uint8Array(n.target.response);if(c=f+this._receivedLength,_&&_.byteLength>0){this._receivedLength+=_.byteLength;var m=Date.now()-this._startTime,w=Ue(this._receivedLength,m);this.emit(J.REAL_TIME_SPEED,{speed:w,len:this._receivedLength,time:m,vid:this._vid,index:this._index,range:[c,f+this._receivedLength],priOptions:this._priOptions})}u=_,((g=this._range)===null||g===void 0?void 0:g.length)>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]?l=!1:l=!0,this._logger.debug("[xhr load done->], tast :",this._range,", start",c,"end ",f+this._receivedLength,",dataLen,",_?_.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",l)}else l=!0,u=n.target.response;var b={ok:s>=200&&s<300,status:s,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(b=this._transformResponse(b,this._url)||b),this._onProgress&&this._onProgress(u,l,{index:this._index,vid:this._vid,range:[c,f+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},b),l?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(Ce(this._onProgress?null:u,l,b,b.headers["content-length"],b.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted&&(this._aborted=!0,this._runing=!1,Te(ce(e.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr))return this._xhr.abort()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(n){this._running=n}},{key:"_getHeaders",value:function(n){var i=n.getAllResponseHeaders().trim().split(`\r
`),s={},o=Et(i),u;try{for(o.s();!(u=o.n()).done;){var l=u.value,c=l.split(": ");s[c[0].toLowerCase()]=c.slice(1).join(": ")}}catch(f){o.e(f)}finally{o.f()}return s}}],[{key:"isSupported",value:function(){return typeof XMLHttpRequest<"u"}}]),e}(Ve),Ut=["retry","retryDelay","onRetryError","transformError"],Mt=function(){function r(a,e){K(this,r),this.promise=he(),this.alive=!!e.onProgress,!e.logger&&(e.logger=new Ae("Loader")),this._loaderType=a,this._loader=a===ue.FETCH&&typeof fetch<"u"?new Me:new Ct,this._config=e,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=e.retryCheckFunc,this._logger=e.logger}return Y(r,[{key:"exec",value:function(){var e=this,t=this._config,n=t.retry,i=t.retryDelay,s=t.onRetryError,o=t.transformError,u=_t(t,Ut),l=function(){var c=re(B().mark(function f(){var g,_,m;return B().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,b.next=3,e._loader.load(u);case 3:g=b.sent,e.promise.resolve(g),b.next=27;break;case 7:if(b.prev=7,b.t0=b.catch(0),e._loader.running=!1,e._logger.debug("[task request catch err]",b.t0),!e._canceled){b.next=13;break}return b.abrupt("return");case 13:if(b.t0.loaderType=e._loaderType,b.t0.retryCount=e._retryCount,_=b.t0,o&&(_=o(_)||_),s&&e._retryCount>0&&s(_,e._retryCount,{index:u.index,vid:u.vid,range:u.range,priOptions:u.priOptions}),e._retryCount++,m=!0,e._retryCheckFunc&&(m=e._retryCheckFunc(b.t0)),!(m&&e._retryCount<=n)){b.next=26;break}return clearTimeout(e._retryTimer),e._logger.debug("[task request setTimeout],retry",e._retryCount,",retry range,",u.range),e._retryTimer=setTimeout(l,i),b.abrupt("return");case 26:e.promise.reject(_);case 27:case"end":return b.stop()}},f,null,[[0,7]])}));return function(){return c.apply(this,arguments)}}();return l(),this.promise}},{key:"cancel",value:function(){var a=re(B().mark(function t(){return B().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,i.abrupt("return",this._loader.cancel());case 4:case"end":return i.stop()}},t,this)}));function e(){return a.apply(this,arguments)}return e}()},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),r}();function sr(r){return r&&!r.paused&&!r.ended&&r.playbackRate!==0&&r.readyState!==0}function or(r){if(!r)return{};if(typeof r.getVideoPlaybackQuality=="function"){var a=r.getVideoPlaybackQuality();return{droppedVideoFrames:a.droppedVideoFrames||a.corruptedVideoFrames,totalVideoFrames:a.totalVideoFrames,creationTime:a.creationTime}}return{droppedVideoFrames:r.webkitDroppedFrameCount,totalVideoFrames:r.webkitDecodedFrameCount,creationTime:performance.now()}}function ur(){for(var r=arguments.length,a=new Array(r),e=0;e<r;e++)a[e]=arguments[e];if(a=a.filter(Boolean),a.length<2)return a[0];var t=new Uint8Array(a.reduce(function(i,s){return i+s.byteLength},0)),n=0;return a.forEach(function(i){t.set(i,n),n+=i.byteLength}),t}function It(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return new Promise(function(a){return setTimeout(a,r)})}var lr=function(r){ye(e,r);var a=me(e);function e(t){var n;return K(this,e),n=a.call(this,t),h(S(n),"type",ue.FETCH),h(S(n),"_queue",[]),h(S(n),"_alive",[]),h(S(n),"_currentTask",null),h(S(n),"_finnalUrl",""),h(S(n),"_config",void 0),n._config=kt(t),(n._config.loaderType===ue.XHR||!Me.isSupported())&&(n.type=ue.XHR),n.log=t.logger,n}return Y(e,[{key:"isFetch",value:function(){return this.type===ue.FETCH}},{key:"load",value:function(n){var i=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};typeof n=="string"||!n?s.url=n||s.url||this._config.url:s=n,s=Object.assign({},this._config,s),s.params&&(s.params=Object.assign({},s.params)),s.headers&&Xe(s.headers)&&(s.headers=Object.assign({},s.headers)),s.body&&Xe(s.body)&&(s.body=Object.assign({},s.body)),s.transformRequest&&(s=s.transformRequest(s)||s),s.logger=this.log;var o=new Mt(this.type,s);return o.loader.on(J.REAL_TIME_SPEED,function(u){i.emit(J.REAL_TIME_SPEED,u)}),this._queue.push(o),this._queue.length===1&&(!this._currentTask||!this._currentTask.running)&&this._processTask(),o.promise}},{key:"cancel",value:function(){var t=re(B().mark(function i(){var s;return B().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return s=this._queue.map(function(l){return l.cancel()}).concat(this._alive.map(function(l){return l.cancel()})),this._currentTask&&s.push(this._currentTask.cancel()),this._queue=[],this._alive=[],u.next=6,Promise.all(s);case 6:return u.next=8,It();case 8:case"end":return u.stop()}},i,this)}));function n(){return t.apply(this,arguments)}return n}()},{key:"_processTask",value:function(){var n=this;if(this._currentTask=this._queue.shift(),!!this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var i=this._currentTask.exec().catch(function(s){});i&&typeof i.finally=="function"&&i.finally(function(){var s,o;(s=n._currentTask)!==null&&s!==void 0&&s.alive&&((o=n._alive)===null||o===void 0?void 0:o.length)>0&&(n._alive=n._alive.filter(function(u){return u&&u!==n._currentTask})),n._processTask()})}}}],[{key:"isFetchSupport",value:function(){return Me.isSupported()}}]),e}(Ve),cr=function(){function r(){K(this,r),h(this,"_prevCurrentTime",0)}return Y(r,[{key:"do",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;if(e){var s=e.currentTime,o=0;if(this._prevCurrentTime===s){var u=oe.info(oe.get(e),s);if(!u.buffers.length)return;n&&u.nextStart||u.nextStart&&u.nextStart-s<t?o=u.nextStart+.1:u.end&&u.end-s>i&&!e.seeking&&(o=s+.1)}this._prevCurrentTime=s,o&&s!==o&&(e.currentTime=o)}}}]),r}(),fr=function(){function r(a){var e=this;K(this,r),h(this,"_seiSet",new Set),this.emitter=a,a.on(J.SEI,function(t){t&&e._seiSet.add(t)})}return Y(r,[{key:"throw",value:function(e,t){var n=this;if(!(e==null||!this._seiSet.size)){var i=e-.2,s=e+.2,o=[];this._seiSet.forEach(function(u){u.time>=i&&u.time<=s&&o.push(u)}),o.forEach(function(u){n._seiSet.delete(u),n.emitter.emit(J.SEI_IN_TIME,u)}),t&&this._seiSet.forEach(function(u){u.time<e-5&&n._seiSet.delete(u)})}}},{key:"reset",value:function(){this._seiSet.clear()}}]),r}(),xt=1e3,Bt=50,Ft=3,Nt=3e3,hr=function(){function r(a){K(this,r),h(this,"_chunkSpeed",0),h(this,"_chunkCache",[]),h(this,"_speeds",[]),h(this,"_totalSize",0),h(this,"_totalCost",0),this._opts=a||{}}return Y(r,[{key:"addRecord",value:function(e,t){!e||!t||(this._speeds.push(8e3*e/t),this._speeds=this._speeds.slice(-Ft))}},{key:"addChunkRecord",value:function(e,t){var n,i;if(!(!e||!t||e<(((n=this._opts)===null||n===void 0?void 0:n.skipChunkSize)||xt))){this._totalSize+=e,this._totalCost+=t,this._chunkSpeed=8e3*e/t,this._chunkCache.push({size:e,duration:t,timestamp:performance.now()});var s=((i=this._opts)===null||i===void 0?void 0:i.chunkCountForSpeed)||Bt;this._chunkCache.length>s&&(this._chunkCache=this._chunkCache.slice(-s))}}},{key:"getAvgSpeed",value:function(){var e;if(!this._chunkCache.length&&!this._speeds.length)return 0;if(this._speeds.length)return this._speeds.reduce(function(o,u){return o+=u})/this._speeds.length;var t=this._chunkCache[this._chunkCache.length-1],n=performance.now()-t.timestamp;n>(((e=this._opts)===null||e===void 0?void 0:e.longtimeNoReceived)||Nt)&&this._chunkCache.push({size:0,duration:n,timestamp:performance.now()});var i=this._chunkCache.reduce(function(o,u){return o+=u.size},0),s=this._chunkCache.reduce(function(o,u){return o+=u.duration},0);return 8e3*i/s}},{key:"getLatestSpeed",value:function(){return!this._chunkCache.length&&!this._speeds.length?0:this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeed}},{key:"getTotalSize",value:function(){return this._totalSize}},{key:"getTotalCost",value:function(){return this._totalCost}},{key:"reset",value:function(){this._chunkCache=[],this._speeds=[],this._totalSize=0,this._totalCost=0}}]),r}(),Ze=function(){function r(a){K(this,r),h(this,"encodeType",""),h(this,"audioCodec",""),h(this,"videoCodec",""),h(this,"domain",""),h(this,"fps",0),h(this,"bitrate",0),h(this,"width",0),h(this,"height",0),h(this,"samplerate",0),h(this,"channelCount",0),h(this,"gop",0),h(this,"_bitsAccumulateSize",0),h(this,"_bitsAccumulateDuration",0),h(this,"_startGopId",-1),this._timescale=a}return Y(r,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(e){this.encodeType=e}},{key:"setFpsFromScriptData",value:function(e){var t,n=e.data,i=n==null||(t=n.onMetaData)===null||t===void 0?void 0:t.framerate;i&&i>0&&i<100&&(this.fps=i)}},{key:"setVideoMeta",value:function(e){if(this.width=e.width,this.height=e.height,this.videoCodec=e.codec,this.encodeType=e.codecType,e.fpsNum&&e.fpsDen){var t=e.fpsNum/e.fpsDen;t>0&&t<100&&(this.fps=t)}}},{key:"setAudioMeta",value:function(e){this.audioCodec=e.codec,this.samplerate=e.sampleRate,this.channelCount=e.channelCount}},{key:"setDomain",value:function(e){this.domain=e.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(e){var t=this;if((!this.fps||this.fps>=100)&&e.length){var n=e.reduce(function(i,s){return i+=s.duration},0)/e.length;this.fps=Math.round(this._timescale/n)}e.forEach(function(i){t._startGopId===-1&&(t._startGopId=i.gopId),i.gopId===t._startGopId&&t.gop++,t._bitsAccumulateDuration+=i.duration/(t._timescale/1e3),t._bitsAccumulateSize+=i.units.reduce(function(s,o){return s+=o.length},0),t._bitsAccumulateDuration>=1e3&&(t.bitrate=t._bitsAccumulateSize*8,t._bitsAccumulateDuration=0,t._bitsAccumulateSize=0)})}}]),r}(),dr=function(){function r(a){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;K(this,r),h(this,"_core",null),h(this,"_samples",[]),this._core=a,this._timescale=e,this._stats=new Ze(e),this._bindEvents()}return Y(r,[{key:"getStats",value:function(){var e,t,n,i,s,o,u,l,c,f,g,_=((e=this._core)===null||e===void 0?void 0:e.media)||{},m=_.currentTime,w=m===void 0?0:m,b=_.decodeFps,D=b===void 0?0:b;return pe(pe({},this._stats.getStats()),{},{downloadSpeed:((t=this._core)===null||t===void 0||(n=t.speedInfo)===null||n===void 0?void 0:n.call(t).speed)||0,avgSpeed:((i=this._core)===null||i===void 0||(s=i.speedInfo)===null||s===void 0?void 0:s.call(i).avgSpeed)||0,totalReceivedByte:((o=this._core)===null||o===void 0||(u=o.speedInfo)===null||u===void 0?void 0:u.call(o).totalSize)||0,totalReceivedCost:((l=this._core)===null||l===void 0||(c=l.speedInfo)===null||c===void 0?void 0:c.call(l).totalCost)||0,currentTime:w,bufferEnd:((f=this._core)===null||f===void 0||(g=f.bufferInfo())===null||g===void 0?void 0:g.remaining)||0,decodeFps:D})}},{key:"_bindEvents",value:function(){var e=this;this._core.on(J.DEMUXED_TRACK,function(t){var n=t.videoTrack;return e._stats.updateBitrate(n.samples)}),this._core.on(J.FLV_SCRIPT_DATA,function(t){e._stats.setFpsFromScriptData(t)}),this._core.on(J.METADATA_PARSED,function(t){t.type==="video"?e._stats.setVideoMeta(t.track):e._stats.setAudioMeta(t.track)}),this._core.on(J.TTFB,function(t){e._stats.setDomain(t.responseUrl)})}},{key:"reset",value:function(){this._samples=[],this._stats=new Ze(this._timescale)}}]),r}();function Gt(r,a){var e=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(e!=null){var t,n,i,s,o=[],u=!0,l=!1;try{if(i=(e=e.call(r)).next,a!==0)for(;!(u=(t=i.call(e)).done)&&(o.push(t.value),o.length!==a);u=!0);}catch(c){l=!0,n=c}finally{try{if(!u&&e.return!=null&&(s=e.return(),Object(s)!==s))return}finally{if(l)throw n}}return o}}function V(r,a){if(!(r instanceof a))throw new TypeError("Cannot call a class as a function")}function et(r,a){for(var e=0;e<a.length;e++){var t=a[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,ht(t.key),t)}}function j(r,a,e){return a&&et(r.prototype,a),e&&et(r,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function p(r,a,e){return a=ht(a),a in r?Object.defineProperty(r,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[a]=e,r}function ct(r,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(a&&a.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),a&&Ie(r,a)}function Oe(r){return Oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Oe(r)}function Ie(r,a){return Ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},Ie(r,a)}function Vt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function jt(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Ht(r,a){if(a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jt(r)}function ft(r){var a=Vt();return function(){var t=Oe(r),n;if(a){var i=Oe(this).constructor;n=Reflect.construct(t,arguments,i)}else n=t.apply(this,arguments);return Ht(this,n)}}function zt(r,a){return qt(r)||Gt(r,a)||je(r,a)||Yt()}function Z(r){return $t(r)||Wt(r)||je(r)||Kt()}function $t(r){if(Array.isArray(r))return xe(r)}function qt(r){if(Array.isArray(r))return r}function Wt(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function je(r,a){if(r){if(typeof r=="string")return xe(r,a);var e=Object.prototype.toString.call(r).slice(8,-1);if(e==="Object"&&r.constructor&&(e=r.constructor.name),e==="Map"||e==="Set")return Array.from(r);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return xe(r,a)}}function xe(r,a){(a==null||a>r.length)&&(a=r.length);for(var e=0,t=new Array(a);e<a;e++)t[e]=r[e];return t}function Kt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vr(r,a){var e=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=je(r))||a){e&&(r=e);var t=0,n=function(){};return{s:n,n:function(){return t>=r.length?{done:!0}:{done:!1,value:r[t++]}},e:function(u){throw u},f:n}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,o;return{s:function(){e=e.call(r)},n:function(){var u=e.next();return i=u.done,u},e:function(u){s=!0,o=u},f:function(){try{!i&&e.return!=null&&e.return()}finally{if(s)throw o}}}}function Xt(r,a){if(typeof r!="object"||r===null)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var t=e.call(r,a||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(r)}function ht(r){var a=Xt(r,"string");return typeof a=="symbol"?a:String(a)}var de={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},Be={AV1:"av1",AVC:"avc",HEVC:"hevc"},se={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m",OPUS:"opus",MP3:"mp3"},pr={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},gr=function(){function r(){V(this,r),p(this,"id",1),p(this,"type",de.VIDEO),p(this,"codecType",Be.AVC),p(this,"pid",-1),p(this,"hvcC",void 0),p(this,"codec",""),p(this,"timescale",0),p(this,"formatTimescale",0),p(this,"sequenceNumber",0),p(this,"baseMediaDecodeTime",0),p(this,"baseDts",0),p(this,"duration",0),p(this,"warnings",[]),p(this,"samples",[]),p(this,"pps",[]),p(this,"sps",[]),p(this,"vps",[]),p(this,"fpsNum",0),p(this,"fpsDen",0),p(this,"sarRatio",[]),p(this,"width",0),p(this,"height",0),p(this,"nalUnitSize",4),p(this,"present",!1),p(this,"isVideoEncryption",!1),p(this,"isAudioEncryption",!1),p(this,"isVideo",!0),p(this,"lastKeyFrameDts",0),p(this,"kid",null),p(this,"pssh",null),p(this,"ext",void 0)}return j(r,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var e=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-e.dts+t.duration}return 0}},{key:"exist",value:function(){return/av01/.test(this.codec)?!0:!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),r}(),_r=function(){function r(){V(this,r),p(this,"id",2),p(this,"type",de.AUDIO),p(this,"codecType",se.AAC),p(this,"pid",-1),p(this,"codec",""),p(this,"container",""),p(this,"sequenceNumber",0),p(this,"sampleDuration",0),p(this,"timescale",0),p(this,"formatTimescale",0),p(this,"baseMediaDecodeTime",0),p(this,"duration",0),p(this,"warnings",[]),p(this,"samples",[]),p(this,"baseDts",0),p(this,"sampleSize",16),p(this,"sampleRate",0),p(this,"channelCount",0),p(this,"objectType",0),p(this,"sampleRateIndex",0),p(this,"config",[]),p(this,"present",!1),p(this,"isVideoEncryption",!1),p(this,"isAudioEncryption",!1),p(this,"kid",null),p(this,"ext",void 0)}return j(r,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&(this.codec||this.container)&&(this.codecType===se.AAC||this.codecType===se.G711PCMA||this.codecType===se.G711PCMU||this.codecType===se.OPUS||this.codecType===se.MP3))}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var e=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-e.dts+t.duration}return 0}}]),r}(),yr=function(){function r(a,e,t){V(this,r),p(this,"flag",{}),p(this,"keyframe",!1),p(this,"gopId",0),p(this,"duration",0),p(this,"size",0),p(this,"units",[]),p(this,"chromaFormat",420),this.originPts=this.pts=a,this.originDts=this.dts=e,t&&(this.units=t)}return j(r,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),r}(),mr=j(function r(a,e,t,n){V(this,r),p(this,"duration",1024),p(this,"flag",{dependsOn:2,isNonSyncSample:0}),p(this,"keyframe",!0),this.originPts=this.pts=this.dts=a,this.data=e,this.size=e.byteLength,this.sampleOffset=n,t&&(this.duration=t)}),dt=j(function r(a,e){V(this,r),p(this,"time",0),this.data=a,this.originPts=this.pts=e}),br=function(r){ct(e,r);var a=ft(e);function e(){return V(this,e),a.apply(this,arguments)}return j(e)}(dt),Er=function(r){ct(e,r);var a=ft(e);function e(){return V(this,e),a.apply(this,arguments)}return j(e)}(dt),Sr=function(){function r(){V(this,r),p(this,"id",3),p(this,"type",de.METADATA),p(this,"timescale",0),p(this,"flvScriptSamples",[]),p(this,"seiSamples",[])}return j(r,[{key:"exist",value:function(){return!!((this.flvScriptSamples.length||this.seiSamples.length)&&this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!!(this.flvScriptSamples.length||this.seiSamples.length)}}]),r}(),Qt=function(){function r(a){V(this,r),this.name=a||"",this._prefix="[".concat(this.name,"]")}return j(r,[{key:"warn",value:function(){var e;if(!r.disabled){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).warn.apply(e,[this._prefix].concat(n))}}}],[{key:"enable",value:function(){r.disabled=!1}},{key:"disable",value:function(){r.disabled=!0}}]),r}();p(Qt,"disabled",!0);var Re=typeof window<"u",He=Re&&navigator.userAgent.toLocaleLowerCase(),Tr=Re&&/^((?!chrome|android).)*safari/.test(He),Jt=Re&&He.includes("firefox"),Zt=Re&&He.includes("android"),er=function(){function r(){V(this,r)}return j(r,null,[{key:"getRateIndexByRate",value:function(e){return r.FREQ.indexOf(e)}},{key:"parseADTS",value:function(e,t){for(var n=e.length,i=0;i+2<n&&!(e[i]===255&&(e[i+1]&246)===240);)i++;if(!(i>=n)){var s=i,o=[],u=(e[i+2]&60)>>>2,l=r.FREQ[u];if(!l)throw new Error("Invalid sampling index: ".concat(u));for(var c=((e[i+2]&192)>>>6)+1,f=(e[i+2]&1)<<2|(e[i+3]&192)>>>6,g=r._getConfig(u,f,c),_=g.config,m=g.codec,w,b,D=0,C=r.getFrameDuration(l);i+7<n;){if(e[i]!==255||(e[i+1]&246)!==240){i++;continue}if(b=(e[i+3]&3)<<11|e[i+4]<<3|(e[i+5]&224)>>5,!b||n-i<b)break;w=(~e[i+1]&1)*2,o.push({pts:t+D*C,data:e.subarray(i+7+w,i+b)}),D++,i+=b}return{skip:s,remaining:i>=n?void 0:e.subarray(i),frames:o,samplingFrequencyIndex:u,sampleRate:l,objectType:c,channelCount:f,codec:m,config:_,originCodec:"mp4a.40.".concat(c)}}}},{key:"parseAudioSpecificConfig",value:function(e){if(e.length){var t=e[0]>>>3,n=(e[0]&7)<<1|e[1]>>>7,i=(e[1]&120)>>>3,s=r.FREQ[n];if(s){var o=r._getConfig(n,i,t),u=o.config,l=o.codec;return{samplingFrequencyIndex:n,sampleRate:s,objectType:t,channelCount:i,config:u,codec:l,originCodec:"mp4a.40.".concat(t)}}}}},{key:"getFrameDuration",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4;return 1024*t/e}},{key:"_getConfig",value:function(e,t,n){var i=[],s,o;return Jt?e>=6?(s=5,o=e-3):(s=2,o=e):Zt?(s=2,o=e):(s=5,o=e,e>=6?o=e-3:t===1&&(s=2,o=e)),i[0]=s<<3,i[0]|=(e&14)>>1,i[1]=(e&1)<<7,i[1]|=t<<3,s===5&&(i[1]|=(o&14)>>1,i[2]=(o&1)<<7,i[2]|=8,i[3]=0),{config:i,codec:"mp4a.40.".concat(s)}}},{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}]),r}();p(er,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);function te(){for(var r=arguments.length,a=new Array(r),e=0;e<r;e++)a[e]=arguments[e];a=a.filter(Boolean);var t=new Uint8Array(a.reduce(function(i,s){return i+s.byteLength},0)),n=0;return a.forEach(function(i){t.set(i,n),n+=i.byteLength}),t}var tr=Math.pow(2,32);function wr(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(r[a]<<8)+(r[a+1]||0)}function Ar(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(r[a]<<16)+(r[a+1]<<8)+(r[a+2]||0)}function Fe(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(r[a]<<24>>>0)+(r[a+1]<<16)+(r[a+2]<<8)+(r[a+3]||0)}function Or(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return Fe(r,a)*tr+Fe(r,a+4)}function rr(r){for(var a="avc1.",e,t=0;t<3;t++)e=r[t].toString(16),e.length<2&&(e="0".concat(e)),a+=e;return a}function tt(r){if(!Array.isArray(r)){for(var a=[],e="",t=0;t<r.length;t++)t%2&&(e=r[t-1]+r[t],a.push(parseInt(e,16)),e="");return a}return r.map(function(n){return parseInt(n,16)})}function Rr(r,a){return+(r+"."+a)}function Pr(r){if(r.length<5)return 0;var a=Math.hypot(r[0],r[3]),e=Math.hypot(r[1],r[4]);return a===0||e===0?0:180*Math.atan2(r[1]/e,r[0]/a)/Math.PI}var Ne=function(){function r(){V(this,r)}return j(r,null,[{key:"parseAnnexB",value:function(e){var t=e.byteLength-1,n=0;do{if(e[t]===0)n++;else break;t--}while(t>0);n>=3&&(e=e.subarray(0,t+1));for(var i=e.length,s=2,o=0;e[s]!==null&&e[s]!==void 0&&e[s]!==1;)s++;if(s++,o=s+2,o>=i)return[];for(var u=[];o<i;)switch(e[o]){case 0:if(e[o-1]!==0){o+=2;break}else if(e[o-2]!==0){o++;break}else if(o<i-1&&e[o+1]!==1){o++;break}s!==o-2&&u.push(e.subarray(s,o-2));do o++;while(e[o]!==1&&o<i);s=o+1,o=s+2;break;case 1:if(e[o-1]!==0||e[o-2]!==0){o+=3;break}s!==o-2&&u.push(e.subarray(s,o-2)),s=o+1,o=s+2;break;default:o+=3;break}return s<i&&u.push(e.subarray(s)),u}},{key:"parseAvcC",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4;if(!(e.length<4)){for(var n=e.length,i=[],s=0,o;s+t<n;)if(o=Fe(e,s),t===3&&(o>>>=8),s+=t,!!o){if(s+o>n)break;i.push(e.subarray(s,s+o)),s+=o}return i}}},{key:"parseSEI",value:function(e,t){for(var n=e.length,i=t?2:1,s=0,o=0,u="";e[i]===255;)s+=255,i++;for(s+=e[i++];e[i]===255;)o+=255,i++;if(o+=e[i++],s===5&&n>i+16)for(var l=0;l<16;l++)u+=e[i].toString(16),i++;return{payload:e.subarray(i,i+o),type:s,size:o,uuid:u}}},{key:"removeEPB",value:function(e){for(var t=e.byteLength,n=[],i=1;i<t-2;)e[i]===0&&e[i+1]===0&&e[i+2]===3?(n.push(i+2),i+=2):i++;if(!n.length)return e;var s=t-n.length,o=new Uint8Array(s),u=0;for(i=0;i<s;u++,i++)u===n[0]&&(u++,n.shift()),o[i]=e[u];return o}}]),r}(),Ge=function(){function r(a){if(V(this,r),p(this,"_bytesAvailable",void 0),p(this,"_bitsAvailable",0),p(this,"_word",0),!a)throw new Error("ExpGolomb data params is required");this._data=a,this._bytesAvailable=a.byteLength,this._bytesAvailable&&this._loadWord()}return j(r,[{key:"bitsAvailable",get:function(){return this._bitsAvailable}},{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(t===0)throw new Error("No bytes available");var n=new Uint8Array(4);n.set(this._data.subarray(e,e+t)),this._word=new DataView(n.buffer).getUint32(0),this._bitsAvailable=t*8,this._bytesAvailable-=t}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{e-=this._bitsAvailable;var t=Math.floor(e/8);e-=t*8,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),n=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),t=e-t,t>0&&this._bitsAvailable?n<<t|this.readBits(t):n}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if(this._word&2147483648>>>e)return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return this.readBits(1)===1}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t=8,n=8,i,s=0;s<e;s++)n!==0&&(i=this.readEG(),n=(t+i+256)%256),t=n===0?t:n}}]),r}(),Dr=function(){function r(){V(this,r)}return j(r,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(e){if(!(e.length<7)){for(var t=(e[4]&3)+1,n,i=[],s=[],o=6,u=e[5]&31,l,c=0;c<u;c++)if(l=e[o]<<8|e[o+1],o+=2,!!l){var f=e.subarray(o,o+l);o+=l,i.push(f),n||(n=r.parseSPS(Ne.removeEPB(f)))}var g=e[o];o++;for(var _,m=0;m<g;m++)_=e[o]<<8|e[o+1],o+=2,_&&(s.push(e.subarray(o,o+_)),o+=_);return{sps:n,spsArr:i,ppsArr:s,nalUnitSize:t}}}},{key:"parseSPS",value:function(e){var t=new Ge(e);t.readUByte();var n=t.readUByte(),i=t.readUByte(),s=t.readUByte();t.skipUEG();var o=420;if(n===100||n===110||n===122||n===244||n===44||n===83||n===86||n===118||n===128||n===138||n===144){var u=t.readUEG();if(u<=3&&(o=[0,420,422,444][u]),u===3&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var l=u!==3?8:12,c=0;c<l;c++)t.readBool()&&(c<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var f=t.readUEG();if(f===0)t.readUEG();else if(f===1){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var g=t.readUEG(),_=0;_<g;_++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var m=t.readUEG(),w=t.readUEG(),b=t.readBits(1);b===0&&t.skipBits(1),t.skipBits(1);var D=0,C=0,I=0,R=0;t.readBool()&&(D=t.readUEG(),C=t.readUEG(),I=t.readUEG(),R=t.readUEG());var T,H,F,q,Q;if(t.readBool()){if(t.readBool()){var k=t.readUByte();switch(k){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:{T=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()];break}}}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var ne=t.readBits(32),v=t.readBits(32);H=t.readBool(),F=v,q=ne*2,Q=F/q}}return{codec:rr(e.subarray(1,4)),profileIdc:n,profileCompatibility:i,levelIdc:s,chromaFormat:o,width:Math.ceil((m+1)*16-2*(D+C)),height:(2-b)*(w+1)*16-(b?2:4)*(I+R),sarRatio:T,fpsNum:F,fpsDen:q,fps:Q,fixedFrame:H}}}]),r}(),Lr=function(){function r(){V(this,r)}return j(r,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!(e.length<23)){t=t||{};for(var n=(e[21]&3)+1,i,s,o=[],u=[],l=[],c=23,f=e[22],g,_,m,w=0;w<f;w++){g=e[c]&63,_=e[c+1]<<8|e[c+2],c+=3;for(var b=0;b<_;b++)if(m=e[c]<<8|e[c+1],c+=2,!!m){switch(g){case 32:{var D=e.subarray(c,c+m);i||(i=r.parseVPS(Ne.removeEPB(D),t)),l.push(D)}break;case 33:{var C=e.subarray(c,c+m);s||(s=r.parseSPS(Ne.removeEPB(C),t)),o.push(C)}break;case 34:u.push(e.subarray(c,c+m));break}c+=m}}return{hvcC:t,sps:s,spsArr:o,ppsArr:u,vpsArr:l,nalUnitSize:n}}}},{key:"parseVPS",value:function(e,t){t=t||{};var n=new Ge(e);n.readUByte(),n.readUByte(),n.readBits(12);var i=n.readBits(3);return t.numTemporalLayers=Math.max(t.numTemporalLayers||0,i+1),n.readBits(17),r._parseProfileTierLevel(n,i,t),t}},{key:"parseSPS",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=t||{};var n=new Ge(e);n.readUByte(),n.readUByte(),n.readBits(4);var i=n.readBits(3);t.numTemporalLayers=Math.max(i+1,t.numTemporalLayers||0),t.temporalIdNested=n.readBits(1),r._parseProfileTierLevel(n,i,t),n.readUEG();var s=t.chromaFormatIdc=n.readUEG(),o=420;s<=3&&(o=[0,420,422,444][s]);var u=0;s===3&&(u=n.readBits(1));var l=n.readUEG(),c=n.readUEG(),f=n.readBits(1),g,_,m,w;if(f===1&&(g=n.readUEG(),_=n.readUEG(),m=n.readUEG(),w=n.readUEG()),t.bitDepthLumaMinus8=n.readUEG(),t.bitDepthChromaMinus8=n.readUEG(),f===1){var b=(s===1||s===2)&&u===0?2:1,D=s===1&&u===0?2:1;l-=b*(_+g),c-=D*(w+m)}return{codec:"hev1.1.6.L93.B0",width:l,height:c,chromaFormat:o,hvcC:t}}},{key:"_parseProfileTierLevel",value:function(e,t,n){var i=n.generalTierFlag||0;n.generalProfileSpace=e.readBits(2),n.generalTierFlag=Math.max(e.readBits(1),i),n.generalProfileIdc=Math.max(e.readBits(5),n.generalProfileIdc||0),n.generalProfileCompatibilityFlags=e.readBits(32),n.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var s=e.readBits(8);i<n.generalTierFlag?n.generalLevelIdc=s:n.generalLevelIdc=Math.max(s,n.generalLevelIdc||0);var o=[],u=[];if(t>e.bitsAvailable)throw new Error("maxSubLayersMinus inavlid size ".concat(t));for(var l=0;l<t;l++)o[l]=e.readBits(1),u[l]=e.readBits(1);t>0&&e.readBits((8-t)*2);for(var c=0;c<t;c++)o[c]!==0&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),u[c]!==0&&e.readBits(8)}}]),r}();function nr(r){for(var a=0,e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];t.forEach(function(o){a+=o.length});var i=new r(a),s=0;return t.forEach(function(o){i.set(o,s),s+=o.length}),i}var $=function(){function r(){V(this,r),this.buffer=new Uint8Array(0)}return j(r,[{key:"write",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];n.forEach(function(s){s?e.buffer=nr(Uint8Array,e.buffer,s):window.console.warn(s)})}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,e&255])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,e&255])}}]),r}(),rt=Math.pow(2,32)-1,O=function(){function r(){V(this,r)}return j(r,null,[{key:"box",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];n=n.filter(Boolean);var s=8+n.reduce(function(l,c){return l+c.byteLength},0),o=new Uint8Array(s);o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=s&255,o.set(e,4);var u=8;return n.forEach(function(l){o.set(l,u),u+=l.byteLength}),o}},{key:"ftyp",value:function(e){var t=e.find(function(n){return n.type===de.VIDEO&&n.codecType===Be.HEVC});return t?r.FTYPHEV1:r.FTYPAVC1}},{key:"initSegment",value:function(e){var t=r.ftyp(e),n=te(t,r.moov(e));return n}},{key:"pssh",value:function(e){var t=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],tt(e.kid),[0,0,0,0]));return r.box(r.types.pssh,t)}},{key:"moov",value:function(e){if(e[0].useEME&&(e[0].encv||e[0].enca)){e[0].pssh||(e[0].pssh={kid:e[0].kid});var t=this.pssh(e[0].pssh);return r.box.apply(r,[r.types.moov,r.mvhd(e[0].mvhdDurtion||e[0].duration,e[0].mvhdTimecale||e[0].timescale),r.mvex(e)].concat(Z(e.map(function(n){return r.trak(n)})),[t]))}else return r.box.apply(r,[r.types.moov,r.mvhd(e[0].mvhdDurtion||e[0].duration,e[0].mvhdTimecale||e[0].timescale)].concat(Z(e.map(function(n){return r.trak(n)})),[r.mvex(e)]))}},{key:"mvhd",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,n=r.box(r.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,e>>24&255,e>>16&255,e>>8&255,e&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return n}},{key:"trak",value:function(e){var t=r.box(r.types.trak,r.tkhd(e.id,e.tkhdDuration||0,e.width,e.height),r.mdia(e));return t}},{key:"tkhd",value:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=r.box(r.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,e>>24&255,e>>16&255,e>>8&255,e&255,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,i>>8&255,i&255,0,0]));return s}},{key:"mdia",value:function(e){var t=r.box(r.types.mdia,r.mdhd(e.duration,e.timescale),r.hdlr(e.type),r.minf(e));return t}},{key:"mdhd",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,n=r.box(r.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,e>>24&255,e>>16&255,e>>8&255,e&255,85,196,0,0]));return n}},{key:"hdlr",value:function(e){var t=r.box(r.types.hdlr,r.HDLR_TYPES[e]);return t}},{key:"minf",value:function(e){var t=r.box(r.types.minf,e.type===de.VIDEO?r.VMHD:r.SMHD,r.DINF,r.stbl(e));return t}},{key:"stbl",value:function(e){var t=[];e&&e.ext&&e.ext.stss&&t.push(r.stss(e.ext.stss.entries));var n=r.box(r.types.stbl,r.stsd(e),r.STTS,t[0],r.STSC,r.STSZ,r.STCO);return n}},{key:"stsd",value:function(e){var t;e.type==="audio"?e.useEME&&e.enca?t=r.enca(e):e.codecType===se.OPUS?t=r.opus(e):t=r.mp4a(e):e.useEME&&e.encv?t=r.encv(e):e.av1C?t=r.av01(e):t=r.avc1hev1(e);var n=r.box(r.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),t);return n}},{key:"enca",value:function(e){var t=e.enca.channelCount,n=e.enca.sampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,n>>8&255,n&255,0,0]),s=r.esds(e.config),o=r.sinf(e.enca);return r.box(r.types.enca,i,s,o)}},{key:"encv",value:function(e){var t,n,i=e.sps.length>0?e.sps[0]:[],s=e.pps.length>0?e.pps[0]:[],o=e.width,u=e.height,l=e.sarRatio[0],c=e.sarRatio[1],f=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,o&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),g=new Uint8Array((t=(n=[1,i[1],i[2],i[3],255,225,i.length>>>8&255,i.length&255]).concat.apply(n,Z(i)).concat([1,s.length>>>8&255,s.length&255])).concat.apply(t,Z(s))),_=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),m=r.sinf(e.encv),w=new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255]);return r.box(r.types.encv,f,r.box(r.types.avcC,g),r.box(r.types.btrt,_),m,r.box(r.types.pasp,w))}},{key:"schi",value:function(e){var t=new Uint8Array([]),n=r.tenc(e);return r.box(r.types.schi,t,n)}},{key:"tenc",value:function(e){var t=new Uint8Array([0,0,0,0,0,0,e.default_IsEncrypted&255,e.default_IV_size&255].concat(tt(e.default_KID)));return r.box(r.types.tenc,t)}},{key:"sinf",value:function(e){var t=new Uint8Array([]),n=new Uint8Array([e.data_format.charCodeAt(0),e.data_format.charCodeAt(1),e.data_format.charCodeAt(2),e.data_format.charCodeAt(3)]),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),s=r.schi(e);return r.box(r.types.sinf,t,r.box(r.types.frma,n),r.box(r.types.schm,i),s)}},{key:"av01",value:function(e){return r.box(r.types.av01,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,e.width>>8&255,e.width&255,e.height>>8&255,e.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),e.av1C,e.colr)}},{key:"avc1hev1",value:function(e){var t=e.codecType===Be.HEVC,n=t?r.types.hvc1:r.types.avc1,i=t?r.hvcC(e):r.avcC(e),s=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,e.width>>8&255,e.width&255,e.height>>8&255,e.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return t?s.push(r.box(r.types.fiel,new Uint8Array([1,0]))):e.sarRatio&&e.sarRatio.length>1&&s.push(r.pasp(e.sarRatio)),r.box.apply(r,[n].concat(s))}},{key:"avcC",value:function(e){var t,n,i=[],s=[],o;return e.sps.forEach(function(u){o=u.byteLength,i.push(o>>>8&255),i.push(o&255),i.push.apply(i,Z(u))}),e.pps.forEach(function(u){o=u.byteLength,s.push(o>>>8&255),s.push(o&255),s.push.apply(s,Z(u))}),r.box(r.types.avcC,new Uint8Array((t=(n=[1,i[3],i[4],i[5],255,224|e.sps.length]).concat.apply(n,i).concat([e.pps.length])).concat.apply(t,s)))}},{key:"hvcC",value:function(e){var t=e.hvcC;if(t instanceof ArrayBuffer||t instanceof Uint8Array)return t;var n=e.vps,i=e.sps,s=e.pps,o;if(t){var u=t.generalProfileCompatibilityFlags,l=t.generalConstraintIndicatorFlags,c=(n.length&&1)+(i.length&&1)+(s.length&&1);o=[1,t.generalProfileSpace<<6|t.generalTierFlag<<5|t.generalProfileIdc,u>>>24,u>>>16,u>>>8,u,l[0],l[1],l[2],l[3],l[4],l[5],t.generalLevelIdc,240,0,252,t.chromaFormatIdc|252,t.bitDepthLumaMinus8|248,t.bitDepthChromaMinus8|248,0,0,t.numTemporalLayers<<3|t.temporalIdNested<<2|3,c];var f=function(_){var m;o.push(_.length>>8,_.length),(m=o).push.apply(m,Z(_))};n.length&&(o.push(160,0,n.length),n.forEach(f)),i.length&&(o.push(161,0,i.length),i.forEach(f)),s.length&&(o.push(162,0,s.length),s.forEach(f))}else o=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return r.box(r.types.hvcC,new Uint8Array(o))}},{key:"pasp",value:function(e){var t=zt(e,2),n=t[0],i=t[1];return r.box(r.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255]))}},{key:"mp4a",value:function(e){return r.box(r.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,e.sampleRate>>8&255,e.sampleRate&255,0,0]),e.config.length?r.esds(e.config):void 0)}},{key:"esds",value:function(e){var t=e.length,n=r.box(r.types.esds,new Uint8Array([0,0,0,0,3,23+t,0,0,0,4,15+t,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([t]).concat(e).concat([6,1,2])));return n}},{key:"opus",value:function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,e.sampleRate>>8&255,e.sampleRate&255,0,0]),n=e.config.length?r.dOps(e):[];return r.box(r.types.Opus,t,n)}},{key:"dOps",value:function(e){if(e.config)return e.config[4]=e.sampleRate>>>24&255,e.config[5]=e.sampleRate>>>16&255,e.config[6]=e.sampleRate>>>8&255,e.config[7]=e.sampleRate&255,r.box(r.types.dOps,e.config)}},{key:"mvex",value:function(e){var t=r.box.apply(r,[r.types.mvex].concat(Z(e.map(function(n){return r.trex(n.id)}))));return t}},{key:"trex",value:function(e){var t=r.box(r.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]));return t}},{key:"trex1",value:function(e){var t=r.box(r.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]));return t}},{key:"trex2",value:function(e){var t=r.box(r.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]));return t}},{key:"moof",value:function(e){var t=r.box.apply(r,[r.types.moof,r.mfhd(e[0].samples?e[0].samples[0].gopId:0)].concat(Z(e.map(function(n){return r.traf(n)}))));return t}},{key:"mfhd",value:function(e){var t=r.box(r.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]));return t}},{key:"traf",value:function(e){var t=r.tfhd(e.id),n=r.tfdt(e,e.baseMediaDecodeTime),i=0,s;if(e.isVideo&&e.videoSenc&&(s=e.videoSenc,s.forEach(function(d){i=i+8,d.subsamples&&d.subsamples.length&&(i=i+2,i=i+d.subsamples.length*6)})),e.videoSencLength=i,!e.useEME||!e.isVideoEncryption&&!e.isAudioEncryption){var o=r.sdtp(e),u=76;return r.box(r.types.traf,t,n,o,r.trun(e.samples,o.byteLength+u))}else if(e.isVideoEncryption)if(e.isVideo){var l=r.saiz(e),c=r.saio(e),f=r.trun1(e),g=r.senc(e),_=r.box(r.types.traf,t,n,l,c,f,g);return _}else if(e.isAudioEncryption){var b=r.sbgp(),D=r.saiz(e),C=r.saio(e),I=r.senc(e),R=r.trun1(e),T=r.box(r.types.traf,t,n,b,D,C,I,R);return T}else{var m=r.sbgp(),w=r.trun1(e);return r.box(r.types.traf,t,n,m,w)}else if(e.isVideo){var H=r.trun1(e);return r.box(r.types.traf,t,n,H)}else{var F=r.sbgp(),q=r.saiz(e),Q=r.saio(e),k=r.senc(e),ne=r.trun1(e),v=r.box(r.types.traf,t,n,F,q,Q,k,ne);return v}}},{key:"sdtp",value:function(e){var t=new $;return e.samples.forEach(function(n){t.write(new Uint8Array(e.isVideo?[n.keyframe?32:16]:[16]))}),r.box(r.types.sdtp,this.extension(0,0),t.buffer)}},{key:"trun1",value:function(e){var t=new $,n=$.writeUint32(e.samples.length),i=null;if(e.isVideo){var s=e.videoSencLength;i=$.writeUint32(e.samples.length*16+s+149),!e.isVideoEncryption&&e.isAudioEncryption&&(i=$.writeUint32(e.samples.length*16+92))}else{var o=e.samples.length*12+124;e.isAudioEncryption&&(o=e.samples.length*12+8*e.audioSenc.length+177),i=$.writeUint32(o)}return e.samples.forEach(function(u){t.write($.writeUint32(u.duration)),t.write($.writeUint32(u.size)),t.write($.writeUint32(u.keyframe?33554432:65536)),e.isVideo&&t.write($.writeUint32(u.cts?u.cts:0))}),r.box(r.types.trun,this.extension(0,e.flags),n,i,t.buffer)}},{key:"senc",value:function(e){var t=new $,n=e.samples.length,i=e.isVideo?16:8,s=e.isVideo?2:0,o=[],u=0;return e.isVideo?(o=e.videoSenc,u=e.videoSencLength):o=e.audioSenc,u=u||i*n,t.write($.writeUint32(16+u),r.types.senc,this.extension(0,s)),t.write($.writeUint32(n)),o.forEach(function(l){for(var c=0;c<l.InitializationVector.length;c++)t.write(new Uint8Array([l.InitializationVector[c]]));l.subsamples&&l.subsamples.length&&(t.write($.writeUint16(l.subsamples.length)),l.subsamples.forEach(function(f){t.write($.writeUint16(f.BytesOfClearData)),t.write($.writeUint32(f.BytesOfProtectedData))}))}),t.buffer}},{key:"saio",value:function(e){var t=e.samples.length*12+141;!e.isVideo&&e.isAudioEncryption&&(t=149);var n=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]);return r.box(r.types.saio,n)}},{key:"saiz",value:function(e){var t=e.samples.length,n=new Uint8Array([0,0,0,0,16,t>>24&255,t>>16&255,t>>8&255,t&255]);return r.box(r.types.saiz,n)}},{key:"sbgp",value:function(){var e=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return r.box(r.types.sbgp,this.extension(0,0),e)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,t&255])}},{key:"tfhd",value:function(e){return r.box(r.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}},{key:"tfdt",value:function(e,t){var n=Math.floor(t/(rt+1)),i=Math.floor(t%(rt+1));return e.useEME&&(e.isVideoEncryption||e.isAudioEncryption)?r.box(r.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])):r.box(r.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255]))}},{key:"trun",value:function(e,t){var n=e.length,i=12+16*n;t+=8+i;var s=new Uint8Array(i);s.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0);for(var o=0;o<n;o++){var u=e[o],l=u.duration,c=u.size,f=u.flag,g=f===void 0?{}:f,_=u.cts,m=_===void 0?0:_;s.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,g.isLeading<<2|(g.dependsOn===null||g.dependsOn===void 0?1:g.dependsOn),g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|(g.isNonSyncSample===null||g.isNonSyncSample===void 0?1:g.isNonSyncSample),g.degradationPriority&61440,g.degradationPriority&15,m>>>24&255,m>>>16&255,m>>>8&255,m&255],12+16*o)}return r.box(r.types.trun,s)}},{key:"moovMP4",value:function(e){return r.box.apply(r,[r.types.moov,r.mvhd(e[0].duration,e[0].timescale)].concat(Z(e.map(function(t){return r.trackMP4(t)}))))}},{key:"trackMP4",value:function(e){return r.box(r.types.trak,r.tkhd(e.id,e.duration,e.width,e.height),r.mdiaMP4(e))}},{key:"mdiaMP4",value:function(e){return r.box(r.types.mdia,r.mdhd(e.duration,e.timescale),r.hdlr(e.type),r.minfMP4(e))}},{key:"minfMP4",value:function(e){return r.box(r.types.minf,e.type===de.VIDEO?r.VMHD:r.SMHD,r.DINF,r.stblMP4(e))}},{key:"stblMP4",value:function(e){var t=e.ext,n=[r.stsd(e),r.stts(t.stts),r.stsc(t.stsc),r.stsz(t.stsz),r.stco(t.stco)];return t.stss.length&&n.push(r.stss(t.stss)),t.ctts.length&&n.push(r.ctts(t.ctts)),r.box.apply(r,[r.types.stbl].concat(n))}},{key:"stts",value:function(e){var t=e.length,n=new Uint8Array(8*t),i=0;return e.forEach(function(s){var o=s.value,u=s.count;n.set([u>>24,u>>16&255,u>>8&255,u&255,o>>24,o>>16&255,o>>8&255,o&255],i),i+=8}),r.box(r.types.stts,te(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),n))}},{key:"stsc",value:function(e){var t=e.length,n=new Uint8Array(12*t),i=0;return e.forEach(function(s){var o=s.firstChunk,u=s.samplesPerChunk,l=s.sampleDescIndex;n.set([o>>24,o>>16&255,o>>8&255,o&255,u>>24,u>>16&255,u>>8&255,u&255,l>>24,l>>16&255,l>>8&255,l&255],i),i+=12}),r.box(r.types.stsc,te(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),n))}},{key:"stsz",value:function(e){var t=e.length,n=new Uint8Array(4*t),i=0;return e.forEach(function(s){n.set([s>>24,s>>16&255,s>>8&255,s&255],i),i+=4}),r.box(r.types.stsz,te(new Uint8Array([0,0,0,0,0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),n))}},{key:"stco",value:function(e){var t=e.length,n=new Uint8Array(4*t),i=0;return e.forEach(function(s){n.set([s>>24,s>>16&255,s>>8&255,s&255],i),i+=4}),r.box(r.types.stco,te(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),n))}},{key:"stss",value:function(e){var t=e.length,n=new Uint8Array(4*t),i=0;return e.forEach(function(s){n.set([s>>24,s>>16&255,s>>8&255,s&255],i),i+=4}),r.box(r.types.stss,te(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),n))}},{key:"ctts",value:function(e){var t=e.length,n=new Uint8Array(8*t),i=0;return e.forEach(function(s){var o=s.value,u=s.count;n.set([u>>24,u>>16&255,u>>8&255,u&255,o>>24,o>>16&255,o>>8&255,o&255],i),i+=8}),r.box(r.types.ctts,te(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),n))}},{key:"styp",value:function(){return r.box(r.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(e){var t=e.timescale,n=e.samples[0].duration,i=n*e.samples.length,s=e.samples[0].sampleOffset*n,o=8;e.samples.forEach(function(g){o+=g.size});var u=0;if(e.isVideo){var l=0,c;e.videoSenc&&(c=e.videoSenc),e.isVideo&&c.forEach(function(g){l=l+8,g.subsamples&&g.subsamples.length&&(l=l+2,l=l+g.subsamples.length*6)}),e.videoSencLength=l,u=o+141+e.samples.length*16+l,e.useEME&&e.isAudioEncryption&&!e.isVideoEncryption&&(u=o+e.samples.length*16+84)}else u=o+116+e.samples.length*12,e.useEME&&e.isAudioEncryption&&(u=o+169+e.samples.length*12+8*e.audioSenc.length);var f=new Uint8Array([0,0,0,0,0,0,0,e.id&255,t>>24&255,t>>16&255,t>>8&255,t&255,s>>24&255,s>>16&255,s>>8&255,s&255,0,0,0,0,0,0,0,1,0,u>>16&255,u>>8&255,u&255,i>>24&255,i>>16&255,i>>8&255,i&255,144,0,0,0]);return r.box(r.types.sidx,f)}},{key:"mdat",value:function(e){var t=r.box(r.types.mdat,e);return t}}]),r}();p(O,"types",["Opus","dOps","av01","av1C","avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce(function(r,a){return r[a]=[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)],r},Object.create(null)));p(O,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])});p(O,"FTYPAVC1",O.box(O.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])));p(O,"FTYPHEV1",O.box(O.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49])));p(O,"DINF",O.box(O.types.dinf,O.box(O.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]))));p(O,"VMHD",O.box(O.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])));p(O,"SMHD",O.box(O.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0])));p(O,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0]));p(O,"STTS",O.box(O.types.stts,O.StblTable));p(O,"STSC",O.box(O.types.stsc,O.StblTable));p(O,"STSZ",O.box(O.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0])));p(O,"STCO",O.box(O.types.stco,O.StblTable));var vt=function(){function r(a,e){V(this,r),this.name=a||"",this._prefix="[".concat(this.name,"]"),r.disabled=e}return j(r,[{key:"debug",value:function(){var e;if(!r.disabled){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).debug.apply(e,[this._prefix].concat(n))}}},{key:"log",value:function(){var e;if(!r.disabled){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).log.apply(e,[this._prefix].concat(n))}}},{key:"warn",value:function(){var e;if(!r.disabled){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).warn.apply(e,[this._prefix].concat(n))}}},{key:"error",value:function(){var e;if(!r.disabled){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).error.apply(e,[this._prefix].concat(n))}}},{key:"table",value:function(){var e;r.disabled||(console.group(this._prefix),(e=console).table.apply(e,arguments),console.groupEnd())}}],[{key:"enable",value:function(){r.disabled=!1}},{key:"disable",value:function(){r.disabled=!0}}]),r}();p(vt,"disabled",!0);var kr=function(){function r(a,e,t){V(this,r),this.videoTrack=a,this.audioTrack=e;var n=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=n&&Number(n[1])<50,this.log=new vt("FMP4Remuxer",t&&t.openLog?!t.openLog:!0)}return j(r,[{key:"remux",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=this.videoTrack,i=this.audioTrack,s=n.exist(),o=i.exist(),u,l,c,f=[];e&&(t&&t.initMerge?(s&&f.push(this.videoTrack),o&&f.push(this.audioTrack),c=O.initSegment(f)):(s&&(u=O.initSegment([this.videoTrack])),o&&(l=O.initSegment([this.audioTrack]))));var g,_;return s&&n.hasSample()&&(g=this._remuxVideo()),o&&i.hasSample()&&(_=this._remuxAudio()),n.samples=[],i.samples=[],{initSegment:c,videoInitSegment:u,audioInitSegment:l,videoSegment:g,audioSegment:_}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack;this.forceFirstIDR&&(e.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=e.samples,n=/av01/.test(e.codec),i=0;n?t.forEach(function(I){i+=I.data.byteLength}):t.forEach(function(I){i+=I.units.reduce(function(R,T){return R+T.byteLength},0),i+=I.units.length*4});var s=new Uint8Array(i);if(n)for(var o=0,u=t.length,l=0,c;o<u;o++)c=t[o],s.set(c.data,l),c.size=c.data.byteLength,l+=c.size;else for(var f=new DataView(s.buffer),g=function(R,T){T=t[_];var H=0;T.units.forEach(function(F){f.setUint32(R,F.byteLength),R+=4,s.set(F,R),R+=F.byteLength,H+=4+F.byteLength}),T.size=H,w=R,b=T},_=0,m=t.length,w=0,b;_<m;_++)g(w,b);var D=O.mdat(s),C=O.moof([e]);return te(C,D)}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=new Uint8Array(e.samples.reduce(function(s,o){return s+o.size},0));e.samples.reduce(function(s,o){return t.set(o.data,s),s+o.size},0);var n=O.mdat(t),i=O.moof([e]);return te(i,n)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),r}();export{se as A,oe as B,hr as C,sr as D,J as E,kr as F,fr as G,Lr as H,cr as I,dr as J,or as K,Qt as L,Sr as M,Ne as N,Le as O,br as P,Er as S,de as T,Be as V,pr as W,j as _,er as a,mr as b,V as c,Jt as d,te as e,Z as f,yr as g,Dr as h,Tr as i,p as j,gr as k,_r as l,Or as m,Ar as n,wr as o,Rr as p,rr as q,Fe as r,vr as s,Pr as t,ur as u,Ae as v,ae as w,L as x,st as y,lr as z};
