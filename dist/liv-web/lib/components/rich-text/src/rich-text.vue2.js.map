{"version":3,"file":"rich-text.vue2.js","sources":["../../../../../../packages/components/rich-text/src/rich-text.vue"],"sourcesContent":["<template>\r\n  <div class=\"liv-rich-text\">\r\n    <component\r\n      :is=\"toolBarComponent\"\r\n      :style=\"\r\n        merge(\r\n          { borderBottom: '1px solid var(--el-border-color)' },\r\n          (propsProxy.toolbar as RichTextToolBarProps)?.style,\r\n        )\r\n      \"\r\n      :editor=\"editorRef\"\r\n      :defaultConfig=\"\r\n        merge(toolbarConfig, (propsProxy.toolbar as RichTextToolBarProps)?.defaultConfig)\r\n      \"\r\n      mode=\"default\"\r\n      v-bind=\"omit(propsProxy.toolbar as RichTextToolBarProps, ['style', 'defaultConfig'])\" />\r\n    <component\r\n      :is=\"editorComponent\"\r\n      :style=\"\r\n        merge(\r\n          { height: '320px', overflowY: 'hidden' },\r\n          (propsProxy.editor as RichTextEditorProps)?.style,\r\n        )\r\n      \"\r\n      v-model=\"model\"\r\n      :defaultConfig=\"\r\n        merge(editorConfig, (propsProxy.editor as RichTextEditorProps)?.defaultConfig)\r\n      \"\r\n      mode=\"default\"\r\n      @onCreated=\"handleCreated\"\r\n      v-bind=\"omit(propsProxy.editor as RichTextEditorProps, ['style', 'defaultConfig'])\" />\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { inject, onBeforeUnmount, onMounted, shallowRef } from 'vue';\r\nimport { merge, omit } from 'lodash-es';\r\nimport type { RichTextProps, RichTextToolBarProps, RichTextEditorProps } from './rich-text';\r\nimport { IEditorConfig, IToolbarConfig } from '@wangeditor/editor';\r\nimport {\r\n  getPropsPoxy,\r\n  injectFileUploadData,\r\n  injectFileUploadHeader,\r\n  injectFileUploadUrl,\r\n  injectHandleFileResponse,\r\n  injectHandleFileUrls,\r\n} from '@liv-web/utils';\r\nimport { RICH_TEXT_KEY } from '@liv-web/constants';\r\n\r\n/**\r\n * 组件配置\r\n */\r\ndefineOptions({\r\n  name: 'LivRichText',\r\n});\r\n\r\n/**\r\n * 注入全局属性\r\n */\r\nconst globalProps = inject(RICH_TEXT_KEY, {});\r\n\r\n/**\r\n * 组件属性\r\n */\r\nconst props = defineProps<RichTextProps>();\r\n\r\n/**\r\n * 属性代理\r\n */\r\nconst propsProxy = getPropsPoxy<RichTextProps>(props, globalProps);\r\n\r\n/**\r\n * 注入文件上传地址\r\n */\r\nconst fileUploadUrl = injectFileUploadUrl();\r\n\r\n/**\r\n * 注入文件上传请求Header\r\n */\r\nconst fileUploadHeader = injectFileUploadHeader();\r\n\r\n/**\r\n * 注入文件上传请求Data\r\n */\r\nconst fileUploadData = injectFileUploadData();\r\n\r\n/**\r\n * 注入处理文件上传返回response方法\r\n */\r\nconst handleFileResponse = injectHandleFileResponse();\r\n\r\n/**\r\n * 注入处理文件地址方法\r\n */\r\nconst handleFileUrls = injectHandleFileUrls();\r\n\r\n/**\r\n * 双向绑定\r\n */\r\nconst model = defineModel<string>();\r\n\r\n/**\r\n * 工具栏组件\r\n */\r\nconst toolBarComponent = shallowRef();\r\n\r\n/**\r\n * 编辑器组件\r\n */\r\nconst editorComponent = shallowRef();\r\n\r\n/**\r\n * 编辑器实例\r\n */\r\nconst editorRef = shallowRef();\r\n\r\n/**\r\n * 组件挂载钩子\r\n */\r\nonMounted(() => {\r\n  // 动态加载富文本编辑器组件\r\n  import('@wangeditor/editor-for-vue')\r\n    .then(module => {\r\n      toolBarComponent.value = module.Toolbar;\r\n      editorComponent.value = module.Editor;\r\n    })\r\n    .catch(error => {\r\n      throw new Error(`[liv-web/rich-text]富文本编辑器加载失败：${JSON.stringify(error)}`);\r\n    });\r\n});\r\n\r\n/**\r\n * 富文本编辑器创建完成钩子\r\n * @param editor 编辑器实例\r\n */\r\nconst handleCreated = (editor: any) => {\r\n  // 记录 editor 实例\r\n  editorRef.value = editor;\r\n};\r\n\r\n/**\r\n * 工具栏默认配置\r\n */\r\nconst toolbarConfig: Partial<IToolbarConfig> = {};\r\n\r\n/**\r\n * 自定义插入方法类型\r\n */\r\ntype InsertFnType = (url: string, alt: string, href: string) => void;\r\n\r\n/**\r\n * 编辑器上传配置\r\n */\r\nconst editorUploadConfig = {\r\n  fieldName: 'file',\r\n  server: fileUploadUrl,\r\n  maxFileSize: 10 * 1024 * 1024,\r\n  headers: fileUploadHeader instanceof Function ? fileUploadHeader() : fileUploadHeader,\r\n  meta: fileUploadData instanceof Function ? fileUploadData() : fileUploadData,\r\n  customInsert(res: any, insertFn: InsertFnType) {\r\n    const url = handleFileUrls?.(handleFileResponse?.(res))[0];\r\n    if (url) {\r\n      insertFn(url, '', '');\r\n    } else {\r\n      console.error(`[liv-web/rich-text]图片处理失败，response=${JSON.stringify(res)}`);\r\n    }\r\n  },\r\n};\r\n\r\n/**\r\n * 编辑器默认配置\r\n */\r\nconst editorConfig: Partial<IEditorConfig> = {\r\n  placeholder: '请输入内容...',\r\n  MENU_CONF: {\r\n    uploadImage: editorUploadConfig,\r\n    uploadVideo: editorUploadConfig,\r\n  },\r\n};\r\n\r\n/**\r\n * 组件写在钩子\r\n */\r\nonBeforeUnmount(() => {\r\n  // 销毁富文本编辑器\r\n  editorRef.value?.destroy();\r\n});\r\n</script>\r\n"],"names":["inject","RICH_TEXT_KEY","getPropsPoxy","injectFileUploadUrl","injectFileUploadHeader","injectFileUploadData","injectHandleFileResponse","injectHandleFileUrls","_useModel","shallowRef","onMounted","onBeforeUnmount"],"mappings":"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"}